<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Agentic Fire and Safety - Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            overflow-x: hidden;
        }

        .header {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .agentic-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }

        .agentic-icon::after {
            content: 'A';
            position: absolute;
            color: white;
            font-weight: 900;
            font-size: 28px;
            font-family: 'Arial Black', sans-serif;
        }

        h1 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
        }

        .subtitle {
            color: #718096;
            font-size: 11px;
            margin-top: 3px;
        }

        .mobile-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            width: 100%;
            order: 3;
        }

        .desktop-nav {
            display: none;
            gap: 12px;
        }

        .desktop-nav .nav-button {
            padding: 10px 20px;
            font-size: 14px;
        }

        .nav-button {
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
            text-decoration: none;
            text-align: center;
            font-size: 13px;
        }

        .nav-button:hover {
            border-color: #dc2626;
            color: #dc2626;
        }

        .nav-button.active {
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            border-color: #dc2626;
            color: white;
        }

        /* Scorecards Section */
        .scorecards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .scorecard {
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid;
            cursor: move;
            position: relative;
            transition: all 0.3s ease;
        }

        .scorecard:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .scorecard.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .scorecard.drag-over {
            border: 2px dashed #dc2626;
        }

        .scorecard.critical {
            border-left-color: #f56565;
        }

        .scorecard.warning {
            border-left-color: #ed8936;
        }

        .scorecard.monitor {
            border-left-color: #48bb78;
        }

        .scorecard.normal {
            border-left-color: #4299e1;
        }

        .scorecard.total {
            border-left-color: #9f7aea;
            background: linear-gradient(135deg, rgba(159, 122, 234, 0.05) 0%, rgba(159, 122, 234, 0.1) 100%);
        }

        .info-icon {
            font-size: 14px;
            color: #9ca3af;
            cursor: help;
            margin-left: 6px;
            transition: color 0.2s;
        }

        .info-icon:hover {
            color: #667eea;
        }

        .scorecard-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.6;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            min-width: 200px;
        }

        /* First card tooltip - align left to prevent off-screen */
        .scorecard.total .scorecard-tooltip {
            left: 0;
            transform: translateX(0) translateY(-10px);
        }

        .scorecard.total .scorecard-tooltip::after {
            left: 20px;
        }

        .scorecard.total:hover .scorecard-tooltip {
            transform: translateX(0) translateY(-15px);
        }

        .scorecard-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.95);
        }

        .scorecard:hover .scorecard-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-15px);
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            /* Tablet - iPad */
            .container {
                padding: 15px;
            }

            .scorecards {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 12px;
            }

            .scorecard {
                padding: 14px;
            }

            .scorecard-value {
                font-size: 28px;
            }

            .chart-card {
                padding: 16px;
            }

            h2 {
                font-size: 16px !important;
            }

            h3 {
                font-size: 15px !important;
            }
        }

        @media (max-width: 768px) {
            /* Mobile - Large phones and small tablets */
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .scorecards {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .scorecard {
                padding: 12px;
            }

            .scorecard-value {
                font-size: 24px;
            }

            .scorecard-label {
                font-size: 11px;
            }

            .scorecard-change {
                font-size: 10px;
            }

            /* Stack date range controls */
            .date-range-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* Mobile navigation */
            .mobile-nav {
                display: flex !important;
                overflow-x: auto;
                gap: 8px;
                padding: 10px 0;
            }

            .nav-button {
                padding: 8px 16px;
                font-size: 12px;
                white-space: nowrap;
            }

            /* Charts responsive */
            .chart-container {
                height: 250px !important;
            }

            /* Traffic lights stack */
            .traffic-lights {
                flex-direction: column;
                gap: 12px;
            }

            .traffic-item {
                width: 100%;
            }

            /* Sites table scroll */
            .table-wrapper {
                overflow-x: auto;
            }

            table {
                min-width: 600px;
            }

            /* Tooltips on mobile */
            .scorecard-tooltip {
                white-space: normal;
                max-width: 250px;
            }

            /* Modal adjustments */
            .modal-content {
                width: 95%;
                max-width: 95%;
                padding: 16px;
            }
        }

        @media (max-width: 480px) {
            /* Mobile - Small phones (iPhone SE, etc) */
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 20px !important;
            }

            .scorecards {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .scorecard {
                padding: 12px;
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }

            .scorecard-header {
                order: 1;
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 0;
            }

            .scorecard-value {
                order: 2;
                font-size: 28px;
                margin-bottom: 0;
            }

            .scorecard-label {
                font-size: 10px;
            }

            .scorecard-change {
                display: none;
            }

            .scorecard-icon {
                font-size: 18px;
            }

            /* Date range - stack vertically */
            .date-range-btn {
                flex: 1;
                min-width: 70px;
                padding: 8px 10px;
                font-size: 11px;
            }

            #customDatePicker {
                flex-direction: column;
            }

            #customDatePicker > div {
                width: 100%;
            }

            /* Chart heights */
            .chart-container {
                height: 200px !important;
            }

            /* Status badges */
            .status-badge {
                font-size: 9px;
                padding: 3px 6px;
            }

            /* Buttons */
            button {
                font-size: 13px;
            }

            .customize-btn {
                font-size: 12px;
                padding: 6px 12px;
            }

            /* Modal full screen on mobile */
            .modal-content {
                width: 100%;
                height: 100%;
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
                padding: 12px;
            }

            .modal-header h3 {
                font-size: 16px !important;
            }

            /* Device analytics modal */
            #deviceAnalyticsModal .modal-content {
                overflow-y: auto;
            }

            .analytics-grid {
                grid-template-columns: 1fr !important;
            }

            /* Flame overlay - responsive */
            #aiLoadingFlame {
                width: 60px !important;
                height: 90px !important;
            }

            .flame-large {
                width: 48px !important;
                height: 72px !important;
            }

            .flame-inner-large {
                width: 30px !important;
                height: 48px !important;
            }

            #aiLoadingOverlay div[style*="font-size: 24px"] {
                font-size: 18px !important;
            }

            /* Table responsive */
            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 6px !important;
            }
        }

        /* Landscape phone/tablet optimization */
        @media (max-width: 926px) and (orientation: landscape) {
            .scorecards {
                grid-template-columns: repeat(5, 1fr);
            }

            .scorecard {
                padding: 10px;
            }

            .scorecard-value {
                font-size: 20px;
            }

            .chart-container {
                height: 220px !important;
            }
        }

        /* iPad specific */
        @media (min-width: 768px) and (max-width: 1024px) {
            .scorecards {
                grid-template-columns: repeat(3, 1fr);
            }

            .traffic-lights {
                flex-direction: row;
            }
        }

        /* Large desktop */
        @media (min-width: 1440px) {
            .container {
                max-width: 1400px;
                margin: 0 auto;
            }

            .scorecards {
                gap: 20px;
            }

            .scorecard {
                padding: 22px;
            }

            .scorecard-value {
                font-size: 38px;
            }
        }

        /* Touch-friendly interactions */
        @media (hover: none) and (pointer: coarse) {
            /* Mobile touch devices */
            button, .scorecard, .nav-button, .date-range-btn {
                -webkit-tap-highlight-color: rgba(102, 126, 234, 0.3);
                touch-action: manipulation;
            }

            button {
                min-height: 44px; /* Apple's recommended touch target */
                min-width: 44px;
            }

            .scorecard:active {
                transform: scale(0.98);
            }

            /* Disable hover effects on touch */
            .scorecard:hover {
                transform: none;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }

            /* Show tooltips on tap instead of hover */
            .scorecard.show-tooltip .scorecard-tooltip {
                opacity: 1;
                visibility: visible;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Prevent text selection on interactive elements */
        button, .scorecard, .nav-button {
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        /* Optimize fonts for mobile */
        @media (max-width: 768px) {
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }

        .scorecard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .customize-btn {
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 12px;
            transition: all 0.2s;
        }

        .customize-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .customize-btn.active {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
        }

        /* Date Range Buttons */
        .date-range-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-range-btn:hover {
            border-color: #cbd5e0;
            background: #f9fafb;
        }

        .date-range-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .edit-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .edit-controls.show {
            display: flex;
        }

        .edit-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .edit-btn.edit {
            background: #3b82f6;
            color: white;
        }

        .edit-btn.edit:hover {
            background: #2563eb;
        }

        .edit-btn.delete {
            background: #ef4444;
            color: white;
        }

        .edit-btn.delete:hover {
            background: #dc2626;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .close-modal:hover {
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #dc2626;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        /* 3D Block Plan Modal */
        .blockplan-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .blockplan-modal.show {
            display: flex;
        }

        .blockplan-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            max-height: 900px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .blockplan-header {
            padding: 15px 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .blockplan-header h3 {
            color: #2d3748;
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .device-info {
            color: #64748b;
            font-size: 12px;
            margin-top: 4px;
        }

        .blockplan-body {
            flex: 1;
            padding: 15px;
            overflow: auto;
            background: #f7fafc;
            -webkit-overflow-scrolling: touch;
        }

        .building-view {
            width: 100%;
            height: 600px;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1200px;
        }

        .building-3d {
            position: relative;
            width: 400px;
            height: 500px;
            transform-style: preserve-3d;
            transform: rotateX(60deg) rotateZ(-45deg);
            animation: gentleRotate 30s ease-in-out infinite;
        }

        @keyframes gentleRotate {
            0%, 100% { transform: rotateX(60deg) rotateZ(-45deg); }
            50% { transform: rotateX(60deg) rotateZ(-35deg); }
        }

        .floor-3d {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .floor-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(99, 102, 241, 0.15));
            border: 3px solid rgba(59, 130, 246, 0.6);
            box-shadow: 
                inset 0 0 30px rgba(59, 130, 246, 0.2),
                0 10px 40px rgba(0, 0, 0, 0.5);
        }

        /* Floor elevation */
        .floor-3d[data-floor="4"] { transform: translateZ(300px); }
        .floor-3d[data-floor="3"] { transform: translateZ(200px); }
        .floor-3d[data-floor="2"] { transform: translateZ(100px); }
        .floor-3d[data-floor="1"] { transform: translateZ(0px); }

        .floor-number {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-weight: 900;
            font-size: 24px;
            text-shadow: 
                0 0 10px rgba(59, 130, 246, 0.8),
                0 0 20px rgba(59, 130, 246, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 10;
        }

        .room-3d {
            position: absolute;
            background: rgba(255, 255, 255, 0.25);
            border: 2px solid rgba(148, 163, 184, 0.6);
            backdrop-filter: blur(2px);
        }

        .room-3d.corridor {
            background: rgba(226, 232, 240, 0.2);
            border: 2px solid rgba(148, 163, 184, 0.4);
        }

        .room-3d.stairwell {
            background: repeating-linear-gradient(
                45deg,
                rgba(241, 245, 249, 0.3),
                rgba(241, 245, 249, 0.3) 8px,
                rgba(226, 232, 240, 0.3) 8px,
                rgba(226, 232, 240, 0.3) 16px
            );
            border: 2px solid rgba(148, 163, 184, 0.7);
        }

        .room-3d.emergency {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid rgba(16, 185, 129, 0.6);
        }

        .room-label-3d {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
            font-weight: 700;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            white-space: nowrap;
        }

        .device-3d {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translateZ(5px);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 0 20px currentColor;
        }

        .device-3d.alarm {
            background: #ef4444;
            border: 3px solid white;
            box-shadow: 
                0 0 20px #ef4444,
                0 0 40px #ef4444,
                0 0 60px #ef4444;
            animation: alarm-pulse-3d 1s infinite;
        }

        @keyframes alarm-pulse-3d {
            0%, 100% { 
                transform: translateZ(5px) scale(1);
                box-shadow: 
                    0 0 20px #ef4444,
                    0 0 40px #ef4444,
                    0 0 60px #ef4444;
            }
            50% { 
                transform: translateZ(15px) scale(1.4);
                box-shadow: 
                    0 0 30px #ef4444,
                    0 0 60px #ef4444,
                    0 0 90px #ef4444;
            }
        }

        .device-3d.fault {
            background: #f59e0b;
            border: 3px solid white;
            box-shadow: 0 0 20px #f59e0b;
            animation: fault-pulse-3d 2s infinite;
        }

        @keyframes fault-pulse-3d {
            0%, 100% { opacity: 1; transform: translateZ(5px); }
            50% { opacity: 0.6; transform: translateZ(10px); }
        }

        .device-3d.isolate {
            background: #fbbf24;
            border: 3px solid white;
            box-shadow: 0 0 15px #fbbf24;
            transform: translateZ(5px);
        }

        .device-3d.normal {
            background: #10b981;
            border: 2px solid white;
            box-shadow: 0 0 10px #10b981;
            transform: translateZ(5px);
        }

        .device-3d::before {
            content: attr(data-icon);
            font-size: 11px;
        }

        .device-3d:active {
            transform: translateZ(20px) scale(1.6) !important;
            z-index: 10000;
        }

        .view-controls {
            position: absolute;
            bottom: 80px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .view-btn {
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .view-btn:active {
            background: rgba(220, 38, 38, 0.9);
            transform: scale(0.95);
        }

        .floor-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-size: 11px;
            font-weight: 700;
            border: 2px solid rgba(59, 130, 246, 0.5);
        }

        .floor-indicator-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
        }

        .floor-indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .floor-indicator-dot.has-alarm {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }

        .floor-indicator-dot.has-fault {
            background: #f59e0b;
            box-shadow: 0 0 10px #f59e0b;
        }

        .floor-indicator-dot.normal {
            background: #10b981;
        }

        @media (max-width: 768px) {
            .building-view {
                height: 500px;
            }

            .building-3d {
                width: 300px;
                height: 400px;
                transform: rotateX(65deg) rotateZ(-45deg) scale(0.9);
            }

            @keyframes gentleRotate {
                0%, 100% { transform: rotateX(65deg) rotateZ(-45deg) scale(0.9); }
                50% { transform: rotateX(65deg) rotateZ(-35deg) scale(0.9); }
            }

            .floor-number {
                font-size: 20px;
            }

            .device-3d {
                width: 24px;
                height: 24px;
            }

            .device-3d::before {
                font-size: 13px;
            }

            .view-btn {
                padding: 8px 12px;
                font-size: 11px;
            }

            .floor-indicator {
                font-size: 10px;
                padding: 10px 12px;
            }
        }

        .view-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .view-btn {
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: rgba(220, 38, 38, 0.9);
        }

        .floor-selector {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            z-index: 100;
        }

        .floor-selector-title {
            color: white;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .floor-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .floor-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .floor-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .floor-btn.has-alarm {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.3);
        }

        .floor-plan {
            width: 95%;
            max-width: 800px;
            height: 90%;
            position: relative;
            background: white;
            border: 3px solid #334155;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .floor-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(30, 41, 59, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            z-index: 10;
        }

        /* Building Structure */
        .room {
            position: absolute;
            border: 2px solid #334155;
            background: rgba(248, 250, 252, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .room-label {
            font-size: 9px;
            color: #64748b;
            font-weight: 600;
            text-align: center;
            pointer-events: none;
        }

        .corridor {
            position: absolute;
            background: rgba(226, 232, 240, 0.9);
            border: 2px solid #cbd5e1;
        }

        .stairwell {
            position: absolute;
            background: repeating-linear-gradient(
                45deg,
                #f1f5f9,
                #f1f5f9 10px,
                #e2e8f0 10px,
                #e2e8f0 20px
            );
            border: 2px solid #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stairwell::after {
            content: 'ðŸš¶';
            font-size: 16px;
        }

        .emergency-exit {
            position: absolute;
            background: #dcfce7;
            border: 2px solid #16a34a;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emergency-exit::after {
            content: 'ðŸšª EXIT';
            font-size: 8px;
            color: #16a34a;
            font-weight: 700;
        }

        /* Device Markers - Enhanced for visibility */
        .device-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 20px currentColor, 0 0 40px currentColor;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            -webkit-tap-highlight-color: transparent;
        }

        .device-marker.alarm {
            background: #ef4444;
            border-color: white;
            box-shadow: 0 0 25px #ef4444, 0 0 50px #ef4444;
            animation: alarm-pulse 1s infinite;
        }

        @keyframes alarm-pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 25px #ef4444, 0 0 50px #ef4444;
            }
            50% { 
                transform: scale(1.3); 
                box-shadow: 0 0 35px #ef4444, 0 0 70px #ef4444;
            }
        }

        .device-marker.fault {
            background: #f59e0b;
            border-color: white;
            box-shadow: 0 0 20px #f59e0b, 0 0 40px #f59e0b;
            animation: fault-pulse 2s infinite;
        }

        @keyframes fault-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .device-marker.normal {
            background: #10b981;
            border-color: white;
            box-shadow: 0 0 10px #10b981;
        }

        .device-marker.isolate {
            background: #fbbf24;
            border-color: white;
            box-shadow: 0 0 15px #fbbf24;
        }

        .device-marker::before {
            content: attr(data-icon);
            font-size: 14px;
        }

        .device-marker:active {
            transform: scale(1.5);
            z-index: 1000;
        }

        .device-tooltip {
            position: fixed;
            background: rgba(30, 41, 59, 0.98);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            z-index: 10000;
            max-width: 280px;
            border: 2px solid #3b82f6;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .device-tooltip .tooltip-header {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 14px;
            color: #60a5fa;
        }

        .device-tooltip .tooltip-row {
            margin: 4px 0;
            font-size: 12px;
        }

        .device-tooltip .tooltip-label {
            color: #94a3b8;
            font-size: 11px;
        }

        .device-tooltip .state-critical {
            color: #ef4444;
            font-weight: 700;
        }

        .device-tooltip .state-warning {
            color: #f59e0b;
            font-weight: 700;
        }

        .device-tooltip .state-normal {
            color: #10b981;
            font-weight: 700;
        }

        .legend {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 15px;
            border-radius: 8px;
            color: white;
            border: 2px solid #475569;
        }

        .legend-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 12px;
            color: #60a5fa;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid white;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .building-view {
                height: 450px;
            }

            .floor-plan {
                width: 98%;
                height: 88%;
            }

            .floor-selector {
                top: 10px;
                left: 10px;
                padding: 8px;
            }

            .floor-selector-title {
                font-size: 10px;
                margin-bottom: 6px;
            }

            .floor-btn {
                padding: 6px 10px;
                font-size: 10px;
            }

            .view-controls {
                top: 10px;
                right: 10px;
                flex-direction: column;
                gap: 6px;
            }

            .view-btn {
                padding: 6px 10px;
                font-size: 10px;
            }

            .device-marker {
                width: 28px;
                height: 28px;
            }

            .device-marker::before {
                font-size: 16px;
            }

            .room-label {
                font-size: 8px;
            }

            .legend {
                bottom: 10px;
                left: 10px;
                padding: 10px 12px;
            }

            .legend-title {
                font-size: 11px;
            }

            .legend-item {
                font-size: 10px;
            }
        }

        /* Site Details & 3D Block Plan Modals */
        .site-details-modal, .block-plan-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .site-details-modal.show, .block-plan-modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .site-details-content {
            background: white;
            border-radius: 12px;
            width: 95%;
            max-width: 1400px;
            margin: 20px;
        }

        .site-details-header {
            padding: 25px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-details-header h2 {
            color: #2d3748;
            font-size: 22px;
            font-weight: 700;
            margin: 0;
        }

        .site-details-info {
            color: #64748b;
            font-size: 13px;
            margin-top: 4px;
        }

        .close-details {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #718096;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .close-details:hover {
            background: #f7fafc;
            color: #2d3748;
        }

        .site-details-body {
            padding: 25px;
        }

        .device-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .device-table th {
            background: #f7fafc;
            padding: 12px 15px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            color: #718096;
            border-bottom: 2px solid #e2e8f0;
        }

        .device-table td {
            padding: 14px 15px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            color: #4a5568;
        }

        .device-table tr:hover {
            background: #f7fafc;
        }

        .device-address {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #2d3748;
        }

        .device-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            background: #e0e7ff;
            color: #3730a3;
        }

        .device-state {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .device-state.normal { background: #dcfce7; color: #166534; }
        .device-state.alarm { background: #fee2e2; color: #991b1b; }
        .device-state.fault { background: #fed7aa; color: #9a3412; }
        .device-state.isolate { background: #fef3c7; color: #92400e; }

        .map-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .map-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* 3D Block Plan */
        .block-plan-content {
            background: white;
            border-radius: 12px;
            width: 95%;
            max-width: 1200px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            margin: 20px;
        }

        .block-plan-header {
            padding: 20px 25px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .block-plan-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
        }

        .block-plan-info {
            color: #64748b;
            font-size: 12px;
            margin-top: 3px;
        }

        .block-plan-body {
            flex: 1;
            padding: 20px;
            position: relative;
        }

        .building-3d-container {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .floor-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 12px;
            z-index: 10;
        }

        .floor-selector h4 {
            margin: 0 0 8px 0;
            font-size: 13px;
            font-weight: 700;
            color: #2d3748;
        }

        .floor-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 4px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.2s;
        }

        .floor-btn:hover {
            background: #e2e8f0;
        }

        .floor-btn.active {
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            border-color: #dc2626;
            color: white;
        }

        .device-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .device-marker.alarm { background: #ef4444; animation: pulse-alarm 1.5s infinite; }
        .device-marker.normal { background: #10b981; }
        .device-marker.fault { background: #f59e0b; }
        .device-marker.isolate { background: #fbbf24; }

        .device-marker:hover {
            transform: scale(1.4);
            z-index: 10;
        }

        @keyframes pulse-alarm {
            0%, 100% { box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0.1), 0 2px 15px rgba(239, 68, 68, 0.6); }
        }

        .device-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            white-space: nowrap;
            z-index: 100;
            display: none;
        }

        .building-legend {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 12px;
        }

        .building-legend h4 {
            margin: 0 0 8px 0;
            font-size: 13px;
            font-weight: 700;
            color: #2d3748;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 5px;
            font-size: 11px;
            color: #4a5568;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .site-details-content, .block-plan-content {
                width: 100%;
                margin: 0;
                border-radius: 0;
                height: 100%;
            }

            .device-table {
                font-size: 12px;
            }

            .device-table th, .device-table td {
                padding: 10px 8px;
            }
        }

        .scorecard-title {
            color: #718096;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .scorecard-icon {
            font-size: 22px;
        }

        .scorecard-value {
            font-size: 36px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            line-height: 1;
        }

        .scorecard-label {
            color: #a0aec0;
            font-size: 13px;
        }

        .scorecard-change {
            margin-top: 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .scorecard-change.positive {
            color: #48bb78;
        }

        .scorecard-change.negative {
            color: #f56565;
        }

        /* Traffic Light Summary */
        .traffic-summary {
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }

        .traffic-summary h3 {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .traffic-lights {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .traffic-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f7fafc;
        }

        .traffic-circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .traffic-circle.critical {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
        }

        .traffic-circle.warning {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
        }

        .traffic-circle.normal {
            background: linear-gradient(135deg, #68d391 0%, #48bb78 100%);
        }

        .traffic-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .traffic-sublabel {
            font-size: 11px;
            color: #a0aec0;
        }

        /* Charts Section */
        .chart-card {
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }

        .chart-card h3 {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .chart-container {
            position: relative;
            height: 280px;
            width: 100%;
        }

        /* Sites Table */
        .sites-table-section {
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }

        .sites-table-section h3 {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .table-controls {
            margin-bottom: 15px;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .filter-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            color: #2d3748;
        }

        .filter-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-btn {
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        /* Desktop Table View */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            display: none;
        }

        thead {
            background: #f7fafc;
        }

        th {
            padding: 15px;
            text-align: left;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
            color: #718096;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 18px 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
            font-size: 14px;
        }

        tbody tr {
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background-color: #f7fafc;
        }

        .site-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .site-name-link {
            font-weight: 600;
            color: #3b82f6;
            cursor: pointer;
            text-decoration: underline;
        }

        .site-name-link:hover {
            color: #2563eb;
        }

        /* Mobile Card View - Hidden on Desktop */
        .site-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #e2e8f0;
            display: block;
        }

        .site-card.critical {
            border-left-color: #f56565;
        }

        .site-card.warning {
            border-left-color: #ed8936;
        }

        .site-card.monitor {
            border-left-color: #f6ad55;
        }

        .site-card.normal {
            border-left-color: #48bb78;
        }

        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 10px;
        }

        .site-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 15px;
            flex: 1;
        }

        .region-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: #edf2f7;
            color: #4a5568;
            white-space: nowrap;
        }

        .site-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }

        .stat-box {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            color: #718096;
            margin-bottom: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 11px;
            color: white;
        }

        .status-indicator.red {
            background: #f56565;
        }

        .status-indicator.amber {
            background: #ed8936;
        }

        .status-indicator.green {
            background: #48bb78;
        }

        .overall-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            width: 100%;
            justify-content: center;
        }

        .overall-status.critical {
            background: #fed7d7;
            color: #c53030;
        }

        .overall-status.warning {
            background: #feebc8;
            color: #c05621;
        }

        .overall-status.monitor {
            background: #fef5e7;
            color: #d69e2e;
        }

        .overall-status.normal {
            background: #c6f6d5;
            color: #2f855a;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: #718096;
            font-size: 14px;
        }

        /* Desktop Styles */
        @media (min-width: 769px) {
            body {
                padding: 20px;
            }

            .container {
                max-width: 1600px;
            }

            .header {
                padding: 25px 40px;
                margin-bottom: 25px;
            }

            .logo-section {
                margin-bottom: 0;
            }

            .agentic-icon {
                width: 50px;
                height: 50px;
            }

            h1 {
                font-size: 32px;
            }

            .subtitle {
                font-size: 14px;
            }

            .mobile-nav {
                display: flex;
                gap: 12px;
                margin-top: 0;
                width: auto;
                order: 0;
            }

            .desktop-nav {
                display: flex;
            }

            .mobile-nav {
                display: none;
            }

            .nav-button {
                padding: 10px 20px;
                font-size: 14px;
            }

            .scorecards {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                margin-bottom: 25px;
            }

            .traffic-lights {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }

            .filter-row {
                grid-template-columns: repeat(4, 1fr);
            }

            .filter-buttons {
                grid-template-columns: repeat(4, 1fr);
            }

            /* Show table, hide cards on desktop */
            table {
                display: table !important;
            }

            .site-card {
                display: none !important;
            }
        }

        @media (min-width: 1025px) {
            .scorecards {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Mobile Styles - Show cards, hide table */
        @media (max-width: 768px) {
            table {
                display: none !important;
            }

            .site-card {
                display: block !important;
            }
        }

        /* 3D Block Plan and Device Modal Styles */
        .map-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .map-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .site-name-link {
            color: #2563eb;
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .site-name-link:hover {
            color: #dc2626;
        }

        .device-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .device-modal.show {
            display: flex;
        }

        .device-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 95%;
            width: 1400px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .device-modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f7fafc 0%, #fff 100%);
        }

        .device-modal-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }

        .device-modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .device-section-title {
            color: #2d3748;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .device-table th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            color: #718096;
            border-bottom: 2px solid #e2e8f0;
        }

        .device-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            color: #4a5568;
        }

        .device-table tr:hover {
            background: #f7fafc;
        }

        .device-address {
            font-weight: 600;
            color: #2d3748;
            font-family: 'Courier New', monospace;
        }

        .device-type {
            display: inline-block;
            padding: 4px 10px;
            background: #edf2f7;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: #4a5568;
        }

        .device-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .device-status-badge.normal {
            background: #dcfce7;
            color: #166534;
        }

        .device-status-badge.alarm {
            background: #fee2e2;
            color: #991b1b;
        }

        .device-status-badge.fault {
            background: #fed7aa;
            color: #9a3412;
        }

        .device-status-badge.prealarm {
            background: #fef3c7;
            color: #92400e;
        }

        .device-status-badge.isolate {
            background: #e0e7ff;
            color: #3730a3;
        }

        .block-plan-container {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            min-height: 500px;
        }

        .building-3d {
            width: 100%;
            height: 500px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 4px 20px rgba(0,0,0,0.3);
        }

        .floor-plan {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Simplified 3D building visualization */
        .building-layer {
            position: absolute;
            width: 80%;
            height: 15%;
            left: 10%;
            background: rgba(100, 116, 139, 0.4);
            border: 2px solid rgba(203, 213, 225, 0.6);
            border-radius: 4px;
            transition: all 0.3s;
        }

        .building-layer:hover {
            background: rgba(100, 116, 139, 0.6);
            transform: translateX(10px);
        }

        .building-layer.floor-0 { bottom: 5%; transform: perspective(400px) rotateX(5deg); }
        .building-layer.floor-1 { bottom: 22%; transform: perspective(400px) rotateX(5deg); }
        .building-layer.floor-2 { bottom: 39%; transform: perspective(400px) rotateX(5deg); }
        .building-layer.floor-3 { bottom: 56%; transform: perspective(400px) rotateX(5deg); }
        .building-layer.floor-4 { bottom: 73%; transform: perspective(400px) rotateX(5deg); }

        .floor-label {
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 700;
            font-size: 12px;
        }

        .device-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: all 0.2s;
            animation: pulse-marker 2s infinite;
        }

        .device-marker:hover {
            transform: scale(1.8);
            z-index: 100;
        }

        .device-marker.alarm {
            background: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 1);
        }

        .device-marker.normal {
            background: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
        }

        .device-marker.fault {
            background: #f59e0b;
            box-shadow: 0 0 15px rgba(245, 158, 11, 1);
        }

        .device-marker.prealarm {
            background: #eab308;
            box-shadow: 0 0 12px rgba(234, 179, 8, 1);
        }

        .device-marker.isolate {
            background: #6366f1;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.8);
        }

        @keyframes pulse-marker {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .device-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            white-space: nowrap;
            z-index: 1000;
            display: none;
        }

        .legend-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .legend-title {
            font-weight: 700;
            font-size: 12px;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            font-size: 11px;
            font-weight: 600;
            color: #4a5568;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid white;
        }

        @media (max-width: 768px) {
            .device-modal-content {
                width: 98%;
                max-height: 95vh;
            }

            .device-modal-body {
                padding: 15px;
            }

            .device-table {
                font-size: 11px;
            }

            .device-table th,
            .device-table td {
                padding: 8px 6px;
            }

            .building-3d {
                height: 350px;
            }

            .device-section-title {
                font-size: 16px;
            }

            .map-btn {
                padding: 4px 8px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <img src="data:image/png;base64,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" alt="Agentic Fire & Safety" style="height: 50px; width: auto;">
            </div>
            <div class="desktop-nav">
                <a href="agentic_monitoring_dashboard.html" class="nav-button active">Overview</a>
                <a href="agentic_product_dashboard.html" class="nav-button">Products</a>
                <a href="agentic_reports_dashboard.html" class="nav-button">Reports</a>
                <a href="agentic_settings_dashboard.html" class="nav-button">Settings</a>
            </div>
            <div class="mobile-nav">
                <a href="agentic_monitoring_dashboard.html" class="nav-button active">Overview</a>
                <a href="agentic_product_dashboard.html" class="nav-button">Products</a>
                <a href="agentic_reports_dashboard.html" class="nav-button">Reports</a>
                <a href="agentic_settings_dashboard.html" class="nav-button">Settings</a>
            </div>
        </div>

        <!-- Date Range Selector -->
        <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <span style="font-weight: 700; color: #2d3748; font-size: 14px;">ðŸ“… Date Range:</span>
                    <button class="date-range-btn active" onclick="setDateRange('mtd')" id="btn-mtd">MTD</button>
                    <button class="date-range-btn" onclick="setDateRange('lastmonth')" id="btn-lastmonth">Last Month</button>
                    <button class="date-range-btn" onclick="setDateRange('ytd')" id="btn-ytd">YTD</button>
                    <button class="date-range-btn" onclick="toggleCustomDatePicker()" id="btn-custom">ðŸ“† Custom</button>
                </div>
                <div style="font-size: 13px; color: #6b7280; font-weight: 600;" id="currentDateRange">
                    Dec 1, 2024 - Dec 31, 2024
                </div>
            </div>
            
            <!-- Custom Date Picker -->
            <div id="customDatePicker" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 2px solid #e5e7eb;">
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase;">Start Date</label>
                        <input type="date" id="startDate" onchange="applyCustomDateRange()" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase;">End Date</label>
                        <input type="date" id="endDate" onchange="applyCustomDateRange()" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    </div>
                    <button onclick="applyCustomDateRange()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 20px;">Apply</button>
                </div>
            </div>
        </div>

        <!-- Scorecards -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="color: #2d3748; font-size: 18px; font-weight: 700; margin: 0;">Key Metrics</h2>
            <button class="customize-btn" onclick="toggleCustomizeMode()" id="customizeBtn">
                <span id="customizeBtnText">âœï¸ Customize</span>
            </button>
        </div>
        <div class="scorecards" id="scorecardsContainer">
            <!-- TOTAL Card -->
            <div class="scorecard total" draggable="true" data-type="total" data-value="159" data-label="Total Requiring Attention" data-change="â†‘ 14 from yesterday" style="cursor: pointer; position: relative;">
                <div class="edit-controls">
                    <button class="edit-btn edit" onclick="event.stopPropagation(); editScorecard(this)" title="Edit">âœï¸</button>
                </div>
                <div class="scorecard-header">
                    <span class="scorecard-title">Total Issues</span>
                    <span class="scorecard-icon">ðŸ“Š</span>
                    <span class="info-icon" title="Sum of Critical + Warning + Monitor devices requiring attention">â„¹ï¸</span>
                </div>
                <div class="scorecard-value">159</div>
                <div class="scorecard-label">Total Requiring Attention</div>
                <div class="scorecard-change negative">â†‘ 14 from yesterday</div>
                <div class="scorecard-tooltip">
                    <strong>Total Issues:</strong> Sum of all devices in Critical, Warning, and Monitor states that require attention.
                </div>
            </div>

            <div class="scorecard critical" draggable="true" data-type="critical" data-value="23" data-label="Devices in ALARM" data-change="â†‘ 5 from yesterday" onclick="openStatusFilter('critical')" style="cursor: pointer; position: relative;">
                <div class="edit-controls">
                    <button class="edit-btn edit" onclick="event.stopPropagation(); editScorecard(this)" title="Edit">âœï¸</button>
                </div>
                <div class="scorecard-header">
                    <span class="scorecard-title">Critical</span>
                    <span class="scorecard-icon">ðŸš¨</span>
                    <span class="info-icon" title="Active ALARM status requiring immediate attention">â„¹ï¸</span>
                </div>
                <div class="scorecard-value">23</div>
                <div class="scorecard-label">Devices in ALARM</div>
                <div class="scorecard-change negative">â†‘ 5 from yesterday</div>
                <div class="scorecard-tooltip">
                    <strong>Critical Criteria:</strong><br>
                    â€¢ Active ALARM status<br>
                    â€¢ Requires immediate attention<br>
                    â€¢ Emergency response needed
                </div>
            </div>

            <div class="scorecard warning" draggable="true" data-type="warning" data-value="47" data-label="FAULT/PRE-ALARM" data-change="â†‘ 12 from yesterday" onclick="openStatusFilter('warning')" style="cursor: pointer; position: relative;">
                <div class="edit-controls">
                    <button class="edit-btn edit" onclick="event.stopPropagation(); editScorecard(this)" title="Edit">âœï¸</button>
                </div>
                <div class="scorecard-header">
                    <span class="scorecard-title">Warning</span>
                    <span class="scorecard-icon">âš ï¸</span>
                    <span class="info-icon" title="FAULT or PRE-ALARM conditions">â„¹ï¸</span>
                </div>
                <div class="scorecard-value">47</div>
                <div class="scorecard-label">FAULT/PRE-ALARM</div>
                <div class="scorecard-change negative">â†‘ 12 from yesterday</div>
                <div class="scorecard-tooltip">
                    <strong>Warning Criteria:</strong><br>
                    â€¢ Device in FAULT state<br>
                    â€¢ PRE-ALARM condition detected<br>
                    â€¢ More than 5 faults in period<br>
                    â€¢ Requires investigation
                </div>
            </div>

            <div class="scorecard monitor" draggable="true" data-type="monitor" data-value="89" data-label="Devices in ISOLATE" data-change="â†“ 3 from yesterday" onclick="openStatusFilter('monitor')" style="cursor: pointer; position: relative;">
                <div class="edit-controls">
                    <button class="edit-btn edit" onclick="event.stopPropagation(); editScorecard(this)" title="Edit">âœï¸</button>
                </div>
                <div class="scorecard-header">
                    <span class="scorecard-title">Monitor</span>
                    <span class="scorecard-icon">ðŸ‘ï¸</span>
                    <span class="info-icon" title="Devices manually isolated for maintenance">â„¹ï¸</span>
                </div>
                <div class="scorecard-value">89</div>
                <div class="scorecard-label">Devices in ISOLATE</div>
                <div class="scorecard-change positive">â†“ 3 from yesterday</div>
                <div class="scorecard-tooltip">
                    <strong>Monitor Criteria:</strong><br>
                    â€¢ Device in ISOLATE state<br>
                    â€¢ Manually disabled for maintenance<br>
                    â€¢ System bypassed<br>
                    â€¢ Requires monitoring
                </div>
            </div>

            <div class="scorecard normal" draggable="true" data-type="normal" data-value="3841" data-label="Functioning normally" data-change="â†‘ 15 from yesterday" onclick="openStatusFilter('normal')" style="cursor: pointer; position: relative;">
                <div class="edit-controls">
                    <button class="edit-btn edit" onclick="event.stopPropagation(); editScorecard(this)" title="Edit">âœï¸</button>
                </div>
                <div class="scorecard-header">
                    <span class="scorecard-title">Normal</span>
                    <span class="scorecard-icon">âœ…</span>
                    <span class="info-icon" title="All systems operational">â„¹ï¸</span>
                </div>
                <div class="scorecard-value">3,841</div>
                <div class="scorecard-label">Functioning normally</div>
                <div class="scorecard-change positive">â†‘ 15 from yesterday</div>
                <div class="scorecard-tooltip">
                    <strong>Normal Criteria:</strong><br>
                    â€¢ No active alarms<br>
                    â€¢ No faults detected<br>
                    â€¢ All systems operational<br>
                    â€¢ Regular monitoring active
                </div>
            </div>
        </div>

        <!-- Traffic Light Summary -->
        <div class="traffic-summary">
            <h3>System Status Overview</h3>
            <div class="traffic-lights">
                <div class="traffic-item" onclick="openStatusFilter('critical')" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="traffic-circle critical">23</div>
                    <div class="traffic-label">CRITICAL</div>
                    <div class="traffic-sublabel">Immediate attention required</div>
                </div>
                <div class="traffic-item" onclick="openStatusFilter('warning')" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="traffic-circle warning">47</div>
                    <div class="traffic-label">WARNING</div>
                    <div class="traffic-sublabel">Action needed soon</div>
                </div>
                <div class="traffic-item" onclick="openStatusFilter('normal')" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="traffic-circle normal">3,930</div>
                    <div class="traffic-label">NORMAL</div>
                    <div class="traffic-sublabel">All systems operational</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-card">
            <h3>Device Status Distribution</h3>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>Status Trends (Last 7 Days)</h3>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- New Management Charts -->
        <div class="chart-card">
            <h3>â±ï¸ Average Response Time to Alarms</h3>
            <div class="chart-container">
                <canvas id="responseTimeChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>ðŸ“Š Device Reliability Score by Floor</h3>
            <div class="chart-container">
                <canvas id="reliabilityChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>ðŸ’° Maintenance Costs (Monthly)</h3>
            <div class="chart-container">
                <canvas id="costsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>ðŸ”§ Most Problematic Zones</h3>
            <div class="chart-container">
                <canvas id="problematicZonesChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>ðŸ“‰ False Alarm Rate Trend</h3>
            <div class="chart-container">
                <canvas id="falseAlarmChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>â° Device Age Distribution</h3>
            <div class="chart-container">
                <canvas id="deviceAgeChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>âœ… Maintenance Compliance Rate</h3>
            <div class="chart-container">
                <canvas id="complianceChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>ðŸ¢ Building Performance Comparison</h3>
            <div class="chart-container">
                <canvas id="buildingComparisonChart"></canvas>
            </div>
        </div>

        <!-- Sites Table -->
        <div class="sites-table-section">
            <h3>Site Status Overview</h3>
            <div class="table-controls">
                <input type="text" id="searchBox" class="search-box" placeholder="Search sites..." onkeyup="filterSites()">
                
                <div class="filter-row">
                    <select id="regionFilter" class="filter-select" onchange="filterSites()">
                        <option value="">All Regions</option>
                        <option value="SA Metro">SA Metro</option>
                        <option value="SA Regional">SA Regional</option>
                    </select>
                    
                    <select id="statusFilter" class="filter-select" onchange="filterSites()">
                        <option value="">All Status</option>
                        <option value="Critical">Critical</option>
                        <option value="Warning">Warning</option>
                        <option value="Monitor">Monitor</option>
                        <option value="Normal">Normal</option>
                    </select>
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="quickFilter('all')">All Sites</button>
                    <button class="filter-btn" onclick="quickFilter('critical')">Critical</button>
                    <button class="filter-btn" onclick="quickFilter('warning')">Warnings</button>
                    <button class="filter-btn" onclick="quickFilter('normal')">Normal</button>
                </div>
            </div>

            <!-- Mobile Card View -->
            <div id="siteCards" class="table-wrapper"></div>

            <!-- Desktop Table View -->
            <table id="siteTable">
                <thead>
                    <tr>
                        <th>Site Name</th>
                        <th>Region</th>
                        <th>Total</th>
                        <th style="text-align: center;">Alarm</th>
                        <th style="text-align: center;">Pre-Alarm</th>
                        <th style="text-align: center;">Fault</th>
                        <th style="text-align: center;">Isolate</th>
                        <th>Status</th>
                        <th style="text-align: center;">Map</th>
                    </tr>
                </thead>
                <tbody id="siteTableBody"></tbody>
            </table>

            <div id="noResults" class="no-results" style="display: none;">
                No sites found matching your search criteria.
            </div>
        </div>
    </div>

    <!-- 3D Block Plan Modal -->
    <div id="blockplanModal" class="blockplan-modal">
        <div class="blockplan-content">
            <div class="blockplan-header">
                <div>
                    <h3 id="modalSiteName">Adelaide Central Hospital - 3D Building View</h3>
                    <div class="device-info" id="deviceInfo">Isometric 3D view - Tap devices for details</div>
                </div>
                <button class="close-modal" onclick="closeBlockplan()">Ã—</button>
            </div>
            <div class="blockplan-body">
                <div class="building-view" id="buildingView">
                    <!-- Floor Status Indicator -->
                    <div class="floor-indicator" id="floorIndicator">
                        <!-- Generated dynamically -->
                    </div>

                    <!-- 3D Building Container -->
                    <div class="building-3d" id="building3D" style="padding: 0; overflow: hidden;">
                        <iframe id="building3DIframe" src="3d_building_interactive_final.html" style="width: 100%; height: 100%; border: none; border-radius: 8px;"></iframe>
                    </div>

                    <!-- View Controls -->
                    <div class="view-controls">
                        <button class="view-btn" onclick="reset3DView()">ðŸ”„ Reset Building</button>
                    </div>

                    <!-- Legend -->
                    <div class="legend">
                        <div class="legend-title">ðŸš¨ DEVICE STATUS</div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ef4444; border-color: white;"></div>
                            <span>ALARM</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #f59e0b; border-color: white;"></div>
                            <span>FAULT</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #fbbf24; border-color: white;"></div>
                            <span>ISOLATE</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #10b981; border-color: white;"></div>
                            <span>NORMAL</span>
                        </div>
                    </div>
                </div>

                <!-- Device List Table -->
                <div class="site-devices-table" style="margin-top: 25px;">
                    <h4 style="color: #2d3748; font-size: 18px; font-weight: 700; margin-bottom: 15px;">ðŸ“‹ All Devices</h4>
                    <div class="table-wrapper">
                        <table style="display: table;">
                            <thead>
                                <tr>
                                    <th>Device ID</th>
                                    <th>Address</th>
                                    <th>Type</th>
                                    <th>State</th>
                                    <th>Floor</th>
                                    <th style="text-align: center;">Map</th>
                                </tr>
                            </thead>
                            <tbody id="deviceTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Scorecard Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Scorecard</h3>
                <button class="close-modal" onclick="closeEditModal()">Ã—</button>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editTitle">Card Title</label>
                    <input type="text" id="editTitle" placeholder="e.g., Critical, Warning">
                </div>
                <div class="form-group">
                    <label for="editValue">Value</label>
                    <input type="number" id="editValue" placeholder="e.g., 23">
                </div>
                <div class="form-group">
                    <label for="editLabel">Description</label>
                    <input type="text" id="editLabel" placeholder="e.g., Devices in ALARM">
                </div>
                <div class="form-group">
                    <label for="editChange">Change Text</label>
                    <input type="text" id="editChange" placeholder="e.g., â†‘ 5 from yesterday">
                </div>
                <div class="form-group">
                    <label for="editIcon">Icon (emoji)</label>
                    <input type="text" id="editIcon" placeholder="e.g., ðŸš¨">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Device Details & 3D Block Plan Modal -->
    <div id="deviceModal" class="device-modal">
        <div class="device-modal-content">
            <div class="device-modal-header">
                <h3 id="deviceModalTitle">Site Devices</h3>
                <button class="close-modal" onclick="closeDeviceModal()">Ã—</button>
            </div>
            <div class="device-modal-body">
                <div class="device-section-title">
                    ðŸ“‹ Device List
                </div>
                <div style="overflow-x: auto;">
                    <table class="device-table" id="deviceTable">
                        <thead>
                            <tr>
                                <th>Address</th>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Last Seen</th>
                                <th style="text-align: center;">3D Map</th>
                            </tr>
                        </thead>
                        <tbody id="deviceTableBody">
                            <!-- Devices populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="device-section-title" style="margin-top: 30px;">
                    ðŸ¢ 3D Block Plan
                </div>
                <div class="block-plan-container">
                    <div class="building-3d" id="building3d">
                        <div class="floor-plan" id="floorPlan">
                            <!-- 3D Building visualization -->
                            <div class="building-layer floor-4">
                                <span class="floor-label">Level 4</span>
                            </div>
                            <div class="building-layer floor-3">
                                <span class="floor-label">Level 3</span>
                            </div>
                            <div class="building-layer floor-2">
                                <span class="floor-label">Level 2</span>
                            </div>
                            <div class="building-layer floor-1">
                                <span class="floor-label">Level 1</span>
                            </div>
                            <div class="building-layer floor-0">
                                <span class="floor-label">Ground</span>
                            </div>
                            <!-- Device markers will be added by JavaScript -->
                        </div>
                        <div class="device-tooltip" id="deviceTooltip"></div>
                    </div>
                    <div class="legend-container">
                        <div class="legend-title">Device Status</div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #ef4444; border-color: white;"></span>
                            <span>Alarm</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #f59e0b; border-color: white;"></span>
                            <span>Fault</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #eab308; border-color: white;"></span>
                            <span>Pre-Alarm</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #6366f1; border-color: white;"></span>
                            <span>Isolate</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: #22c55e; border-color: white;"></span>
                            <span>Normal</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Open device analytics by status
        function openStatusFilter(status) {
            const modal = document.getElementById('statusFilterModal');
            if (!modal) {
                alert('Analytics system loading... Please try again in a moment.');
                return;
            }
            
            const statusIcons = {
                critical: 'ðŸš¨',
                warning: 'âš ï¸',
                monitor: 'ðŸ‘ï¸',
                normal: 'âœ…'
            };
            const statusTitles = {
                critical: 'Critical Devices',
                warning: 'Warning Devices', 
                monitor: 'Monitor Devices',
                normal: 'Normal Devices'
            };
            const statusLabels = {
                critical: 'CRITICAL',
                warning: 'WARNING',
                monitor: 'MONITOR',
                normal: 'NORMAL'
            };
            const counts = { critical: 23, warning: 47, monitor: 89, normal: 3841 };
            
            document.getElementById('statusIcon').textContent = statusIcons[status];
            document.getElementById('statusModalTitle').textContent = statusTitles[status];
            document.getElementById('statusBadge').className = `status-badge-large ${status}`;
            document.getElementById('statusBadge').textContent = statusLabels[status];
            document.getElementById('deviceCount').textContent = `${counts[status]} devices`;
            
            generateDeviceTable(status, counts[status]);
            modal.style.display = 'flex';
        }

        // Customization and Drag-and-Drop functionality
        let isCustomizeMode = false;
        let currentEditCard = null;

        function toggleCustomizeMode() {
            isCustomizeMode = !isCustomizeMode;
            const btn = document.getElementById('customizeBtn');
            const btnText = document.getElementById('customizeBtnText');
            const editControls = document.querySelectorAll('.edit-controls');
            
            if (isCustomizeMode) {
                btn.classList.add('active');
                btnText.textContent = 'âœ“ Done';
                editControls.forEach(ctrl => ctrl.classList.add('show'));
            } else {
                btn.classList.remove('active');
                btnText.textContent = 'âœï¸ Customize';
                editControls.forEach(ctrl => ctrl.classList.remove('show'));
            }
        }

        function editScorecard(btn) {
            const card = btn.closest('.scorecard');
            currentEditCard = card;
            
            const title = card.querySelector('.scorecard-title').textContent;
            const value = card.querySelector('.scorecard-value').textContent.replace(/,/g, '');
            const label = card.querySelector('.scorecard-label').textContent;
            const change = card.querySelector('.scorecard-change').textContent;
            const icon = card.querySelector('.scorecard-icon').textContent;
            
            document.getElementById('editTitle').value = title;
            document.getElementById('editValue').value = value;
            document.getElementById('editLabel').value = label;
            document.getElementById('editChange').value = change;
            document.getElementById('editIcon').value = icon;
            
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditCard = null;
        }

        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (currentEditCard) {
                const title = document.getElementById('editTitle').value;
                const value = document.getElementById('editValue').value;
                const label = document.getElementById('editLabel').value;
                const change = document.getElementById('editChange').value;
                const icon = document.getElementById('editIcon').value;
                
                currentEditCard.querySelector('.scorecard-title').textContent = title;
                currentEditCard.querySelector('.scorecard-value').textContent = parseInt(value).toLocaleString();
                currentEditCard.querySelector('.scorecard-label').textContent = label;
                currentEditCard.querySelector('.scorecard-change').textContent = change;
                currentEditCard.querySelector('.scorecard-icon').textContent = icon;
                
                // Update data attributes
                currentEditCard.dataset.value = value;
                currentEditCard.dataset.label = label;
                currentEditCard.dataset.change = change;
                
                closeEditModal();
            }
        });

        // Drag and Drop functionality
        const container = document.getElementById('scorecardsContainer');
        let draggedElement = null;

        container.addEventListener('dragstart', function(e) {
            if (!isCustomizeMode) return;
            draggedElement = e.target.closest('.scorecard');
            if (draggedElement) {
                draggedElement.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }
        });

        container.addEventListener('dragend', function(e) {
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
            // Remove all drag-over classes
            document.querySelectorAll('.scorecard').forEach(card => {
                card.classList.remove('drag-over');
            });
        });

        container.addEventListener('dragover', function(e) {
            if (!isCustomizeMode || !draggedElement) return;
            e.preventDefault();
            
            const afterElement = getDragAfterElement(container, e.clientY, e.clientX);
            if (afterElement == null) {
                container.appendChild(draggedElement);
            } else {
                container.insertBefore(draggedElement, afterElement);
            }
        });

        container.addEventListener('dragenter', function(e) {
            if (!isCustomizeMode) return;
            const target = e.target.closest('.scorecard');
            if (target && target !== draggedElement) {
                target.classList.add('drag-over');
            }
        });

        container.addEventListener('dragleave', function(e) {
            const target = e.target.closest('.scorecard');
            if (target) {
                target.classList.remove('drag-over');
            }
        });

        function getDragAfterElement(container, y, x) {
            const draggableElements = [...container.querySelectorAll('.scorecard:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // 3D Block Plan Functions
        let currentSite = null;

        function openDeviceModal(siteName, show3D = false) {
            const site = sitesData.find(s => s.name === siteName);
            if (!site || !site.devices) {
                alert('Device data not available for this site yet.');
                return;
            }

            currentSite = site;
            document.getElementById('modalSiteName').textContent = `${siteName} - 3D Building View`;
            document.getElementById('deviceInfo').textContent = `${site.devices.length} devices across 4 floors - Click floors to explore rooms`;

            // Populate device table
            populateDeviceTable(site.devices);

            // Show modal
            document.getElementById('blockplanModal').classList.add('show');
        }

        function reset3DView() {
            const iframe = document.getElementById('building3DIframe');
            if (iframe && iframe.contentWindow && iframe.contentWindow.resetView) {
                iframe.contentWindow.resetView();
            }
        }

        let rotationPaused = false;

        function getDeviceMarkerClass(state) {
            if (state === 'ALARM') return 'alarm';
            if (state === 'FAULT' || state === 'PRE-ALARM') return 'fault';
            return 'normal';
        }

        function showDeviceTooltip(e, device) {
            let tooltip = document.getElementById('deviceTooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'deviceTooltip';
                tooltip.className = 'device-tooltip';
                document.body.appendChild(tooltip);
            }

            const stateClass = device.state === 'ALARM' ? 'state-critical' : 
                              (device.state === 'FAULT' || device.state === 'PRE-ALARM') ? 'state-warning' : 'state-normal';

            tooltip.innerHTML = `
                <div class="tooltip-header">${device.address}</div>
                <div class="tooltip-row"><span class="tooltip-label">Type:</span> ${device.type}</div>
                <div class="tooltip-row"><span class="tooltip-label">State:</span> <span class="${stateClass}">${device.state}</span></div>
                <div class="tooltip-row"><span class="tooltip-label">Floor:</span> Floor ${device.floor}</div>
                <div class="tooltip-row"><span class="tooltip-label">Device ID:</span> ${device.id}</div>
            `;
            
            tooltip.style.display = 'block';
            
            // Position tooltip near the click/touch point
            let left = e.pageX + 15;
            let top = e.pageY - 60;
            
            // Keep tooltip on screen
            if (left + 280 > window.innerWidth) {
                left = e.pageX - 295;
            }
            if (top < 10) {
                top = e.pageY + 15;
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        function hideDeviceTooltip() {
            const tooltip = document.getElementById('deviceTooltip');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }

        function getStateColor(state) {
            if (state === 'ALARM') return '#ef4444';
            if (state === 'PRE-ALARM') return '#f59e0b';
            if (state === 'FAULT') return '#f59e0b';
            return '#10b981';
        }

        function populateDeviceTable(devices) {
            const tbody = document.getElementById('deviceTableBody');
            tbody.innerHTML = '';

            devices.forEach(device => {
                const row = document.createElement('tr');
                const stateClass = device.state === 'ALARM' ? 'critical' : 
                                  (device.state === 'FAULT' || device.state === 'PRE-ALARM') ? 'warning' : 'normal';
                
                row.innerHTML = `
                    <td><strong>${device.id}</strong></td>
                    <td>${device.address}</td>
                    <td>${device.type}</td>
                    <td><span class="overall-status ${stateClass}"><span class="status-dot"></span>${device.state}</span></td>
                    <td>Floor ${device.floor}</td>
                    <td style="text-align: center;">
                        <button class="map-btn" onclick="highlightDevice('${device.id}')" title="Locate on map">ðŸ“ Locate</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function highlightDevice(deviceId) {
            // Remove previous highlights
            document.querySelectorAll('.device-marker').forEach(m => {
                m.style.transform = '';
                m.style.zIndex = '';
            });

            // Highlight the selected device
            const marker = document.querySelector(`[data-device-id="${deviceId}"]`);
            if (marker) {
                marker.style.transform = 'scale(2)';
                marker.style.zIndex = '1000';
                
                // Scroll to the 3D view
                document.getElementById('buildingView').scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Reset after 3 seconds
                setTimeout(() => {
                    marker.style.transform = '';
                    marker.style.zIndex = '';
                }, 3000);
            }
        }

        function closeBlockplan() {
            document.getElementById('blockplanModal').classList.remove('show');
            currentSite = null;
        }

        // Close block plan modal when clicking outside
        document.getElementById('blockplanModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBlockplan();
            }
        });

        // Site Data
        const sitesData = [
            {
                name: "Adelaide Central Hospital",
                region: "SA Metro",
                total: 1247,
                alarm: 8,
                preAlarm: 12,
                fault: 5,
                isolate: 23,
                status: "Critical",
                devices: [
                    // Floor 4 - ICU (15 devices)
                    { id: "D030", address: "L4-ICU1-001", type: "Smoke Detector", state: "ALARM", floor: 4, x: 15, y: 15 },
                    { id: "D031", address: "L4-ICU1-002", type: "Heat Detector", state: "NORMAL", floor: 4, x: 15, y: 25 },
                    { id: "D032", address: "L4-ICU2-003", type: "Smoke Detector", state: "ALARM", floor: 4, x: 35, y: 15 },
                    { id: "D033", address: "L4-ICU2-004", type: "Heat Detector", state: "NORMAL", floor: 4, x: 35, y: 25 },
                    { id: "D034", address: "L4-ICU3-005", type: "Smoke Detector", state: "ALARM", floor: 4, x: 55, y: 15 },
                    { id: "D035", address: "L4-ICU3-006", type: "Heat Detector", state: "FAULT", floor: 4, x: 55, y: 25 },
                    { id: "D036", address: "L4-ICU4-007", type: "Smoke Detector", state: "NORMAL", floor: 4, x: 75, y: 15 },
                    { id: "D037", address: "L4-ICU4-008", type: "Heat Detector", state: "NORMAL", floor: 4, x: 75, y: 25 },
                    { id: "D038", address: "L4-Critical-009", type: "Smoke Detector", state: "ALARM", floor: 4, x: 20, y: 55 },
                    { id: "D039", address: "L4-Critical-010", type: "Heat Detector", state: "NORMAL", floor: 4, x: 25, y: 60 },
                    { id: "D040", address: "L4-Critical-011", type: "Manual Call Point", state: "NORMAL", floor: 4, x: 30, y: 65 },
                    { id: "D041", address: "L4-Monitor-012", type: "Smoke Detector", state: "NORMAL", floor: 4, x: 45, y: 55 },
                    { id: "D042", address: "L4-Nurses-013", type: "Smoke Detector", state: "ALARM", floor: 4, x: 70, y: 55 },
                    { id: "D043", address: "L4-Nurses-014", type: "Heat Detector", state: "NORMAL", floor: 4, x: 70, y: 65 },
                    { id: "D044", address: "L4-Equipment-015", type: "Smoke Detector", state: "NORMAL", floor: 4, x: 15, y: 80 },
                    
                    // Floor 3 - Patient Wards (12 devices)
                    { id: "D020", address: "L3-WardA1-001", type: "Smoke Detector", state: "ALARM", floor: 3, x: 12, y: 12 },
                    { id: "D021", address: "L3-WardA2-002", type: "Heat Detector", state: "NORMAL", floor: 3, x: 28, y: 12 },
                    { id: "D022", address: "L3-WardA3-003", type: "Smoke Detector", state: "ALARM", floor: 3, x: 44, y: 12 },
                    { id: "D023", address: "L3-WardB1-004", type: "Smoke Detector", state: "NORMAL", floor: 3, x: 60, y: 12 },
                    { id: "D024", address: "L3-WardB2-005", type: "Heat Detector", state: "NORMAL", floor: 3, x: 76, y: 12 },
                    { id: "D025", address: "L3-Treatment-006", type: "Smoke Detector", state: "ALARM", floor: 3, x: 17, y: 50 },
                    { id: "D026", address: "L3-Treatment-007", type: "Heat Detector", state: "NORMAL", floor: 3, x: 22, y: 55 },
                    { id: "D027", address: "L3-Treatment-008", type: "Manual Call Point", state: "NORMAL", floor: 3, x: 27, y: 60 },
                    { id: "D028", address: "L3-Nurses-009", type: "Smoke Detector", state: "NORMAL", floor: 3, x: 43, y: 50 },
                    { id: "D029", address: "L3-Nurses-010", type: "Heat Detector", state: "NORMAL", floor: 3, x: 43, y: 60 },
                    { id: "D045", address: "L3-Family-011", type: "Smoke Detector", state: "NORMAL", floor: 3, x: 69, y: 50 },
                    { id: "D046", address: "L3-Utility-012", type: "Smoke Detector", state: "NORMAL", floor: 3, x: 15, y: 80 },
                    
                    // Floor 2 - Surgery & Emergency (14 devices)
                    { id: "D004", address: "L2-OR1-001", type: "Manual Call Point", state: "ALARM", floor: 2, x: 15, y: 15 },
                    { id: "D047", address: "L2-OR1-002", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 18, y: 20 },
                    { id: "D048", address: "L2-OR1-003", type: "Heat Detector", state: "NORMAL", floor: 2, x: 22, y: 25 },
                    { id: "D010", address: "L2-OR2-004", type: "Heat Detector", state: "FAULT", floor: 2, x: 37, y: 15 },
                    { id: "D049", address: "L2-OR2-005", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 40, y: 25 },
                    { id: "D005", address: "L2-OR3-006", type: "Smoke Detector", state: "ALARM", floor: 2, x: 59, y: 15 },
                    { id: "D050", address: "L2-OR3-007", type: "Heat Detector", state: "NORMAL", floor: 2, x: 62, y: 25 },
                    { id: "D051", address: "L2-Emergency-008", type: "Smoke Detector", state: "ALARM", floor: 2, x: 77, y: 15 },
                    { id: "D052", address: "L2-Emergency-009", type: "Manual Call Point", state: "ALARM", floor: 2, x: 77, y: 25 },
                    { id: "D015", address: "L2-PreOp-010", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 14, y: 52 },
                    { id: "D053", address: "L2-PreOp-011", type: "Heat Detector", state: "NORMAL", floor: 2, x: 18, y: 58 },
                    { id: "D054", address: "L2-Recovery1-012", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 51, y: 52 },
                    { id: "D055", address: "L2-Recovery2-013", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 72, y: 52 },
                    { id: "D019", address: "L2-Steril-014", type: "Smoke Detector", state: "NORMAL", floor: 2, x: 15, y: 80 },
                    
                    // Floor 1 - Reception (7 devices)
                    { id: "D001", address: "L1-Lobby-001", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 20, y: 20 },
                    { id: "D002", address: "L1-Lobby-002", type: "Heat Detector", state: "NORMAL", floor: 1, x: 30, y: 30 },
                    { id: "D003", address: "L1-Reception-003", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 52, y: 12 },
                    { id: "D006", address: "L1-Waiting-004", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 21, y: 72 },
                    { id: "D056", address: "L1-Clinic1-005", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 54, y: 61 },
                    { id: "D057", address: "L1-Clinic2-006", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 74, y: 61 },
                    { id: "D058", address: "L1-Pharmacy-007", type: "Smoke Detector", state: "NORMAL", floor: 1, x: 54, y: 84 }
                ]
            },
            {
                name: "Westfield Marion",
                region: "SA Metro",
                total: 892,
                alarm: 3,
                preAlarm: 7,
                fault: 9,
                isolate: 15,
                status: "Critical"
            },
            {
                name: "Adelaide Airport",
                region: "SA Metro",
                total: 654,
                alarm: 0,
                preAlarm: 4,
                fault: 8,
                isolate: 11,
                status: "Warning"
            },
            {
                name: "Port Adelaide Warehouse",
                region: "SA Regional",
                total: 423,
                alarm: 0,
                preAlarm: 2,
                fault: 6,
                isolate: 8,
                status: "Warning"
            },
            {
                name: "Glenelg Office Tower",
                region: "SA Metro",
                total: 318,
                alarm: 0,
                preAlarm: 0,
                fault: 3,
                isolate: 5,
                status: "Monitor"
            },
            {
                name: "Norwood Shopping Centre",
                region: "SA Metro",
                total: 567,
                alarm: 0,
                preAlarm: 0,
                fault: 0,
                isolate: 7,
                status: "Normal"
            },
            {
                name: "Barossa Valley Resort",
                region: "SA Regional",
                total: 241,
                alarm: 0,
                preAlarm: 0,
                fault: 0,
                isolate: 4,
                status: "Normal"
            },
            {
                name: "Flinders University",
                region: "SA Metro",
                total: 1658,
                alarm: 12,
                preAlarm: 18,
                fault: 14,
                isolate: 26,
                status: "Critical"
            }
        ];

        // Render sites
        function renderSites(sites) {
            const cardsContainer = document.getElementById('siteCards');
            const tableBody = document.getElementById('siteTableBody');
            const noResults = document.getElementById('noResults');
            
            cardsContainer.innerHTML = '';
            tableBody.innerHTML = '';
            
            if (sites.length === 0) {
                noResults.style.display = 'block';
                return;
            }
            
            noResults.style.display = 'none';
            
            sites.forEach(site => {
                // Mobile card view
                const card = document.createElement('div');
                card.className = `site-card ${site.status.toLowerCase()}`;
                card.style.cursor = 'pointer';
                card.onclick = () => openDeviceModal(site.name);
                card.innerHTML = `
                    <div class="site-header">
                        <div class="site-name">${site.name}</div>
                        <span class="region-badge">${site.region}</span>
                    </div>
                    <div class="site-stats">
                        <div class="stat-box">
                            <div class="stat-label">Alarm</div>
                            <div class="stat-value">
                                <span class="status-indicator ${site.alarm > 0 ? 'red' : 'green'}">${site.alarm}</span>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Pre-Alarm</div>
                            <div class="stat-value">
                                <span class="status-indicator ${site.preAlarm > 0 ? 'amber' : 'green'}">${site.preAlarm}</span>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Fault</div>
                            <div class="stat-value">
                                <span class="status-indicator ${site.fault > 0 ? 'amber' : 'green'}">${site.fault}</span>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Isolate</div>
                            <div class="stat-value">
                                <span class="status-indicator ${site.isolate > 0 ? 'green' : 'green'}">${site.isolate}</span>
                            </div>
                        </div>
                    </div>
                    <div class="overall-status ${site.status.toLowerCase()}">
                        <span class="status-dot"></span>${site.status}
                    </div>
                    <div style="text-align: center; margin-top: 12px;">
                        <button class="map-btn" onclick="event.stopPropagation(); openDeviceModal('${site.name}', true)">ðŸ—ºï¸ View 3D Map</button>
                    </div>
                `;
                cardsContainer.appendChild(card);
                
                // Desktop table view
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="site-name-link" onclick="openDeviceModal('${site.name}')">${site.name}</span></td>
                    <td><span class="region-badge">${site.region}</span></td>
                    <td>${site.total}</td>
                    <td style="text-align: center;"><span class="status-indicator ${site.alarm > 0 ? 'red' : 'green'}">${site.alarm}</span></td>
                    <td style="text-align: center;"><span class="status-indicator ${site.preAlarm > 0 ? 'amber' : 'green'}">${site.preAlarm}</span></td>
                    <td style="text-align: center;"><span class="status-indicator ${site.fault > 0 ? 'amber' : 'green'}">${site.fault}</span></td>
                    <td style="text-align: center;"><span class="status-indicator ${site.isolate > 0 ? 'green' : 'green'}">${site.isolate}</span></td>
                    <td><span class="overall-status ${site.status.toLowerCase()}"><span class="status-dot"></span>${site.status}</span></td>
                    <td style="text-align: center;">
                        <button class="map-btn" onclick="openDeviceModal('${site.name}', true)">ðŸ—ºï¸ 3D Map</button>
                        ${site.name === 'Adelaide Central Hospital' ? '<button class="map-btn" onclick="openMapScale(\'' + site.name + '\')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-left: 8px;">ðŸ—ºï¸ MapScaleâ„¢</button>' : ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Open MapScale system for location
        function openMapScale(siteName) {
            sessionStorage.setItem('currentSite', siteName);
            window.location.href = 'integrated_mapscale_system.html';
        }

        // Filter sites
        function filterSites() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const regionFilter = document.getElementById('regionFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const filtered = sitesData.filter(site => {
                const matchesSearch = site.name.toLowerCase().includes(searchTerm);
                const matchesRegion = !regionFilter || site.region === regionFilter;
                const matchesStatus = !statusFilter || site.status === statusFilter;
                
                return matchesSearch && matchesRegion && matchesStatus;
            });
            
            renderSites(filtered);
        }

        // Quick filter buttons
        function quickFilter(type) {
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Reset other filters
            document.getElementById('searchBox').value = '';
            document.getElementById('regionFilter').value = '';
            document.getElementById('statusFilter').value = '';
            
            let filtered = sitesData;
            
            if (type === 'critical') {
                filtered = sitesData.filter(site => site.status === 'Critical');
            } else if (type === 'warning') {
                filtered = sitesData.filter(site => site.status === 'Warning');
            } else if (type === 'normal') {
                filtered = sitesData.filter(site => site.status === 'Normal');
            }
            
            renderSites(filtered);
        }

        // Initial render
        renderSites(sitesData);

        // Global Charts Storage
        let dashboardCharts = {};

        // Device Status Distribution Chart
        const statusCtx = document.getElementById('statusChart');
        if (statusCtx) {
            dashboardCharts.statusChart = new Chart(statusCtx.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Normal', 'Isolate', 'Fault', 'Pre-Alarm', 'Alarm'],
                datasets: [{
                    data: [3841, 89, 28, 19, 23],
                    backgroundColor: ['#48bb78', '#4299e1', '#ed8936', '#f6ad55', '#f56565'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            padding: 10
                        }
                    }
                }
            }
        });
        }

        // Status Trends Chart
        const trendCtx = document.getElementById('trendChart');
        if (trendCtx) {
            dashboardCharts.trendChart = new Chart(trendCtx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['Jan 30', 'Jan 31', 'Feb 1', 'Feb 2', 'Feb 3', 'Feb 4', 'Feb 5'],
                datasets: [
                    {
                        label: 'Alarm',
                        data: [15, 18, 19, 21, 18, 20, 23],
                        borderColor: '#f56565',
                        backgroundColor: 'rgba(245, 101, 101, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Fault',
                        data: [22, 25, 28, 26, 27, 29, 28],
                        borderColor: '#ed8936',
                        backgroundColor: 'rgba(237, 137, 54, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Pre-Alarm',
                        data: [12, 14, 15, 18, 16, 17, 19],
                        borderColor: '#f6ad55',
                        backgroundColor: 'rgba(246, 173, 85, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            usePointStyle: true,
                            padding: 10
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { font: { size: 10 } }
                    },
                    x: {
                        ticks: { font: { size: 10 } }
                    }
                }
            }
        });
        }

        // New Management Charts
        const responseTimeCtx = document.getElementById('responseTimeChart');
        if (responseTimeCtx) {
            dashboardCharts.responseTimeChart = new Chart(responseTimeCtx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Avg Response Time (minutes)',
                    data: [4.2, 3.8, 3.5, 3.1, 2.9, 2.7],
                    backgroundColor: '#667eea'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, title: { display: true, text: 'Minutes' } } }
            }
        });
        }

        const reliabilityCtx = document.getElementById('reliabilityChart');
        if (reliabilityCtx) {
            dashboardCharts.reliabilityChart = new Chart(reliabilityCtx.getContext('2d'), {
            type: 'radar',
            data: {
                labels: ['Floor 1', 'Floor 2', 'Floor 3', 'Floor 4'],
                datasets: [{
                    label: 'Reliability Score',
                    data: [92, 85, 88, 79],
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: '#667eea',
                    pointBackgroundColor: '#667eea'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { r: { min: 0, max: 100 } }
            }
        });
        }

        const costsCtx = document.getElementById('costsChart');
        if (costsCtx) {
            dashboardCharts.costsChart = new Chart(costsCtx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Maintenance Costs ($)',
                    data: [3200, 2800, 3100, 2900, 3400, 3000],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
        }

        const problematicZonesCtx = document.getElementById('problematicZonesChart');
        if (problematicZonesCtx) {
            dashboardCharts.problematicZonesChart = new Chart(problematicZonesCtx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Surgery Wing', 'ICU', 'Emergency', 'Reception', 'Ward A'],
                datasets: [{
                    label: 'Alarm Events',
                    data: [18, 15, 12, 8, 6],
                    backgroundColor: ['#ef4444', '#f59e0b', '#eab308', '#3b82f6', '#6366f1']
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
        }

        const falseAlarmCtx = document.getElementById('falseAlarmChart');
        if (falseAlarmCtx) {
            dashboardCharts.falseAlarmChart = new Chart(falseAlarmCtx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [{
                    label: 'False Alarm %',
                    data: [12, 10, 8, 6],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, max: 15 } }
            }
        });
        }

        const deviceAgeCtx = document.getElementById('deviceAgeChart');
        if (deviceAgeCtx) {
            dashboardCharts.deviceAgeChart = new Chart(deviceAgeCtx.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['0-2 years', '3-5 years', '6-8 years', '9+ years'],
                datasets: [{
                    data: [35, 42, 18, 5],
                    backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });
        }

        const complianceCtx = document.getElementById('complianceChart');
        if (complianceCtx) {
            dashboardCharts.complianceChart = new Chart(complianceCtx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Compliance %',
                    data: [94, 96, 98, 97, 99, 98],
                    backgroundColor: '#10b981'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { min: 90, max: 100 } }
            }
        });
        }

        const buildingComparisonCtx = document.getElementById('buildingComparisonChart');
        if (buildingComparisonCtx) {
            dashboardCharts.buildingComparisonChart = new Chart(buildingComparisonCtx.getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Adelaide Central', 'Westfield Marion', 'Adelaide Airport', 'Port Adelaide'],
                datasets: [{
                    label: 'Health Score',
                    data: [87, 92, 89, 85],
                    backgroundColor: ['#667eea', '#3b82f6', '#10b981', '#f59e0b']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { min: 0, max: 100 } }
            }
        });
        }

        // Date Range Functions
        let currentStartDate = new Date(2024, 11, 1); // Dec 1, 2024
        let currentEndDate = new Date(2024, 11, 31); // Dec 31, 2024

        // Function to generate data based on date range
        function generateDataForRange(startDate, endDate) {
            const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const monthsDiff = Math.ceil(daysDiff / 30);
            
            // Generate varying data based on time period
            const baseMultiplier = monthsDiff / 6; // Scale based on period length
            
            return {
                statusData: [
                    Math.round(3841 * (0.9 + Math.random() * 0.2)),
                    Math.round(89 * (0.9 + Math.random() * 0.2)),
                    Math.round(28 * (0.9 + Math.random() * 0.2)),
                    Math.round(19 * (0.9 + Math.random() * 0.2)),
                    Math.round(23 * (0.9 + Math.random() * 0.2))
                ],
                trendData: {
                    alarm: Array.from({length: 7}, () => Math.round(15 + Math.random() * 15)),
                    fault: Array.from({length: 7}, () => Math.round(22 + Math.random() * 10)),
                    preAlarm: Array.from({length: 7}, () => Math.round(12 + Math.random() * 10))
                },
                responseTime: Array.from({length: 6}, (_, i) => (4.5 - i * 0.3 + Math.random() * 0.5).toFixed(1)),
                reliability: [90 + Math.random() * 5, 83 + Math.random() * 5, 85 + Math.random() * 5, 77 + Math.random() * 5],
                costs: Array.from({length: 6}, () => Math.round(2800 + Math.random() * 600)),
                problematicZones: [
                    Math.round(15 + Math.random() * 8),
                    Math.round(12 + Math.random() * 8),
                    Math.round(10 + Math.random() * 6),
                    Math.round(6 + Math.random() * 5),
                    Math.round(4 + Math.random() * 5)
                ],
                falseAlarm: Array.from({length: 4}, (_, i) => Math.round(13 - i * 2 + Math.random() * 2)),
                compliance: Array.from({length: 6}, () => Math.round(93 + Math.random() * 6))
            };
        }

        function setDateRange(range) {
            const today = new Date();
            
            // Deactivate all buttons
            document.querySelectorAll('.date-range-btn').forEach(btn => btn.classList.remove('active'));
            
            // Hide custom picker
            document.getElementById('customDatePicker').style.display = 'none';
            
            if (range === 'mtd') {
                currentStartDate = new Date(today.getFullYear(), today.getMonth(), 1);
                currentEndDate = today;
                document.getElementById('btn-mtd').classList.add('active');
            } else if (range === 'lastmonth') {
                currentStartDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                currentEndDate = new Date(today.getFullYear(), today.getMonth(), 0);
                document.getElementById('btn-lastmonth').classList.add('active');
            } else if (range === 'ytd') {
                currentStartDate = new Date(today.getFullYear(), 0, 1);
                currentEndDate = today;
                document.getElementById('btn-ytd').classList.add('active');
            }
            
            updateDateRangeDisplay();
            refreshAllData();
        }

        function toggleCustomDatePicker() {
            const picker = document.getElementById('customDatePicker');
            const isVisible = picker.style.display === 'block';
            
            // Hide picker if visible
            if (isVisible) {
                picker.style.display = 'none';
                document.getElementById('btn-custom').classList.remove('active');
            } else {
                // Show picker
                picker.style.display = 'block';
                document.getElementById('btn-custom').classList.add('active');
                
                // Set default dates in YYYY-MM-DD format
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                
                const formatDate = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };
                
                document.getElementById('startDate').value = formatDate(firstDay);
                document.getElementById('endDate').value = formatDate(today);
            }
        }

        function applyCustomDateRange() {
            const startInput = document.getElementById('startDate');
            const endInput = document.getElementById('endDate');
            
            if (startInput.value && endInput.value) {
                currentStartDate = new Date(startInput.value);
                currentEndDate = new Date(endInput.value);
                
                // Deactivate preset buttons
                document.querySelectorAll('.date-range-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('btn-custom').classList.add('active');
                
                updateDateRangeDisplay();
                refreshAllData();
            }
        }

        function updateDateRangeDisplay() {
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            const start = currentStartDate.toLocaleDateString('en-US', options);
            const end = currentEndDate.toLocaleDateString('en-US', options);
            document.getElementById('currentDateRange').textContent = `${start} - ${end}`;
        }

        function refreshAllData() {
            console.log('Refreshing data for range:', currentStartDate, 'to', currentEndDate);
            
            // Generate new data based on date range
            const newData = generateDataForRange(currentStartDate, currentEndDate);
            
            // Update Status Distribution Chart
            if (dashboardCharts.statusChart) {
                dashboardCharts.statusChart.data.datasets[0].data = newData.statusData;
                dashboardCharts.statusChart.update();
            }
            
            // Update Trend Chart
            if (dashboardCharts.trendChart) {
                dashboardCharts.trendChart.data.datasets[0].data = newData.trendData.alarm;
                dashboardCharts.trendChart.data.datasets[1].data = newData.trendData.fault;
                dashboardCharts.trendChart.data.datasets[2].data = newData.trendData.preAlarm;
                dashboardCharts.trendChart.update();
            }
            
            // Update Response Time Chart
            if (dashboardCharts.responseTimeChart) {
                dashboardCharts.responseTimeChart.data.datasets[0].data = newData.responseTime;
                dashboardCharts.responseTimeChart.update();
            }
            
            // Update Reliability Chart
            if (dashboardCharts.reliabilityChart) {
                dashboardCharts.reliabilityChart.data.datasets[0].data = newData.reliability;
                dashboardCharts.reliabilityChart.update();
            }
            
            // Update Costs Chart
            if (dashboardCharts.costsChart) {
                dashboardCharts.costsChart.data.datasets[0].data = newData.costs;
                dashboardCharts.costsChart.update();
            }
            
            // Update Problematic Zones Chart
            if (dashboardCharts.problematicZonesChart) {
                dashboardCharts.problematicZonesChart.data.datasets[0].data = newData.problematicZones;
                dashboardCharts.problematicZonesChart.update();
            }
            
            // Update False Alarm Chart
            if (dashboardCharts.falseAlarmChart) {
                dashboardCharts.falseAlarmChart.data.datasets[0].data = newData.falseAlarm;
                dashboardCharts.falseAlarmChart.update();
            }
            
            // Update Compliance Chart
            if (dashboardCharts.complianceChart) {
                dashboardCharts.complianceChart.data.datasets[0].data = newData.compliance;
                dashboardCharts.complianceChart.update();
            }
            
            // Update Scorecards with new data
            const totalDevices = newData.statusData.reduce((a, b) => a + b, 0);
            const totalCard = document.querySelector('.scorecard.total .scorecard-value');
            const criticalCard = document.querySelector('.scorecard.critical .scorecard-value');
            const warningCard = document.querySelector('.scorecard.warning .scorecard-value');
            const monitorCard = document.querySelector('.scorecard.monitor .scorecard-value');
            const normalCard = document.querySelector('.scorecard.normal .scorecard-value');
            
            const criticalVal = newData.statusData[4];
            const warningVal = newData.statusData[2] + newData.statusData[3];
            const monitorVal = newData.statusData[1];
            const totalVal = criticalVal + warningVal + monitorVal;
            
            if (totalCard) totalCard.textContent = totalVal;
            if (criticalCard) criticalCard.textContent = criticalVal;
            if (warningCard) warningCard.textContent = warningVal;
            if (monitorCard) monitorCard.textContent = monitorVal;
            if (normalCard) normalCard.textContent = newData.statusData[0];
        }

        // Mobile touch handling for tooltips
        if ('ontouchstart' in window) {
            document.querySelectorAll('.scorecard').forEach(card => {
                let tooltipTimeout;
                
                card.addEventListener('touchstart', function(e) {
                    // Close other tooltips
                    document.querySelectorAll('.scorecard').forEach(c => c.classList.remove('show-tooltip'));
                    
                    // Show this tooltip
                    this.classList.add('show-tooltip');
                    
                    // Auto-hide after 3 seconds
                    clearTimeout(tooltipTimeout);
                    tooltipTimeout = setTimeout(() => {
                        this.classList.remove('show-tooltip');
                    }, 3000);
                });
            });
            
            // Close tooltips when tapping outside
            document.addEventListener('touchstart', function(e) {
                if (!e.target.closest('.scorecard')) {
                    document.querySelectorAll('.scorecard').forEach(c => c.classList.remove('show-tooltip'));
                }
            });
        }

        // Initialize default date range
        updateDateRangeDisplay();
        console.log('Dashboard loaded successfully. Charts initialized:', Object.keys(dashboardCharts).length);

        // Device Modal and 3D Map Functions
        function generateDeviceData(siteName) {
            const deviceTypes = [
                { type: 'Smoke Detector', icon: 'ðŸ”¥', weight: 0.6 },
                { type: 'Heat Detector', icon: 'ðŸŒ¡ï¸', weight: 0.2 },
                { type: 'Manual Call Point', icon: 'ðŸš¨', weight: 0.15 },
                { type: 'Beam Detector', icon: 'ðŸ“¡', weight: 0.05 }
            ];
            
            const statuses = ['Normal', 'Alarm', 'Fault', 'Pre-Alarm', 'Isolate'];
            const floors = ['Ground', 'Level 1', 'Level 2', 'Level 3', 'Level 4'];
            const locations = ['Corridor', 'Office', 'Server Room', 'Stairwell', 'Lobby', 'Storage', 'Meeting Room'];
            
            const devices = [];
            const numDevices = Math.floor(Math.random() * 30) + 20;
            
            for (let i = 0; i < numDevices; i++) {
                const typeRoll = Math.random();
                let selectedType = deviceTypes[0];
                let cumulative = 0;
                
                for (const type of deviceTypes) {
                    cumulative += type.weight;
                    if (typeRoll <= cumulative) {
                        selectedType = type;
                        break;
                    }
                }
                
                let status = 'Normal';
                const statusRoll = Math.random();
                if (statusRoll < 0.02) status = 'Alarm';
                else if (statusRoll < 0.05) status = 'Fault';
                else if (statusRoll < 0.08) status = 'Pre-Alarm';
                else if (statusRoll < 0.12) status = 'Isolate';
                
                const floor = floors[Math.floor(Math.random() * floors.length)];
                const location = locations[Math.floor(Math.random() * locations.length)];
                
                devices.push({
                    address: `${String(i + 1).padStart(3, '0')}`,
                    type: selectedType.type,
                    icon: selectedType.icon,
                    location: `${floor} - ${location}`,
                    floor: floor,
                    status: status,
                    lastSeen: Math.floor(Math.random() * 60) + ' mins ago',
                    x: Math.random() * 80 + 10,
                    y: floors.indexOf(floor) * 17 + 7 + (Math.random() * 10)
                });
            }
            
            return devices;
        }

        function openDeviceModal(siteName, scrollToMap = false) {
            const modal = document.getElementById('deviceModal');
            const title = document.getElementById('deviceModalTitle');
            const tableBody = document.getElementById('deviceTableBody');
            const floorPlan = document.getElementById('floorPlan');
            
            title.textContent = `${siteName} - Device Details & 3D Block Plan`;
            
            const devices = generateDeviceData(siteName);
            
            tableBody.innerHTML = '';
            devices.forEach(device => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="device-address">${device.address}</span></td>
                    <td><span class="device-type">${device.icon} ${device.type}</span></td>
                    <td>${device.location}</td>
                    <td><span class="device-status-badge ${device.status.toLowerCase()}">${device.status}</span></td>
                    <td style="color: #718096; font-size: 12px;">${device.lastSeen}</td>
                    <td style="text-align: center;"><button class="map-btn" onclick="highlightDevice('${device.address}')">ðŸ“ Show</button></td>
                `;
                tableBody.appendChild(row);
            });
            
            const existingMarkers = floorPlan.querySelectorAll('.device-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            devices.forEach(device => {
                const marker = document.createElement('div');
                marker.className = `device-marker ${device.status.toLowerCase()}`;
                marker.id = `marker-${device.address}`;
                marker.style.left = `${device.x}%`;
                marker.style.bottom = `${device.y}%`;
                marker.setAttribute('data-device', JSON.stringify(device));
                
                marker.addEventListener('mouseenter', function(e) {
                    const tooltip = document.getElementById('deviceTooltip');
                    const deviceData = JSON.parse(this.getAttribute('data-device'));
                    tooltip.innerHTML = `
                        <strong>${deviceData.icon} ${deviceData.address}</strong><br>
                        ${deviceData.type}<br>
                        ${deviceData.location}<br>
                        <span style="color: ${getStatusColor(deviceData.status)}">${deviceData.status}</span>
                    `;
                    tooltip.style.display = 'block';
                    tooltip.style.left = (e.pageX + 15) + 'px';
                    tooltip.style.top = (e.pageY - 10) + 'px';
                });
                
                marker.addEventListener('mousemove', function(e) {
                    const tooltip = document.getElementById('deviceTooltip');
                    tooltip.style.left = (e.pageX + 15) + 'px';
                    tooltip.style.top = (e.pageY - 10) + 'px';
                });
                
                marker.addEventListener('mouseleave', function() {
                    document.getElementById('deviceTooltip').style.display = 'none';
                });
                
                floorPlan.appendChild(marker);
            });
            
            modal.classList.add('show');
            
            if (scrollToMap) {
                setTimeout(() => {
                    document.getElementById('building3d').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }

        function closeDeviceModal() {
            document.getElementById('deviceModal').classList.remove('show');
        }

        function highlightDevice(address) {
            const marker = document.getElementById(`marker-${address}`);
            if (marker) {
                document.getElementById('building3d').scrollIntoView({ behavior: 'smooth', block: 'center' });
                marker.style.transform = 'scale(2.5)';
                marker.style.zIndex = '200';
                setTimeout(() => {
                    marker.style.transform = 'scale(1)';
                    marker.style.zIndex = '';
                }, 2000);
            }
        }

        function getStatusColor(status) {
            const colors = {
                'Alarm': '#ef4444',
                'Fault': '#f59e0b',
                'Pre-Alarm': '#eab308',
                'Isolate': '#6366f1',
                'Normal': '#22c55e'
            };
            return colors[status] || '#718096';
        }

        document.getElementById('deviceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDeviceModal();
            }
        });

        // Device Analytics Functions
        function generateDeviceTable(status, count) {
            const tbody = document.getElementById('analyticsDeviceTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const sites = ['Adelaide Central Hospital', 'Westfield Marion', 'Adelaide Airport'];
            const types = ['Smoke Detector', 'Heat Detector', 'Manual Call Point', 'Beam Detector'];
            const locations = [
                'Level 4, Pediatric Nurse Office',
                'Level 5, Emergency Foyer',
                'Level 3, Operating Room',
                'Level 2, Main Corridor',
                'Level 1, Reception Area'
            ];
            
            for (let i = 0; i < Math.min(count, 20); i++) {
                const zone = Math.floor(Math.random() * 5) + 1;
                const loop = Math.floor(Math.random() * 10) + 1;
                const device = Math.floor(Math.random() * 50) + 1;
                const address = `Zone ${zone}, Loop ${loop}, Device ${device}`;
                const location = locations[Math.floor(Math.random() * locations.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const site = sites[Math.floor(Math.random() * sites.length)];
                
                let healthScore;
                if (status === 'critical') healthScore = 30 + Math.floor(Math.random() * 30);
                else if (status === 'warning') healthScore = 60 + Math.floor(Math.random() * 20);
                else if (status === 'monitor') healthScore = 70 + Math.floor(Math.random() * 15);
                else healthScore = 85 + Math.floor(Math.random() * 15);
                
                let healthClass = 'excellent';
                if (healthScore < 60) healthClass = 'poor';
                else if (healthScore < 75) healthClass = 'fair';
                else if (healthScore < 90) healthClass = 'good';
                
                const row = document.createElement('tr');
                row.onclick = () => openDeviceAnalytics(address, location, type, status, healthScore);
                row.style.cursor = 'pointer';
                row.innerHTML = `
                    <td><span style="font-family: 'Courier New', monospace; font-weight: 700;">${address}</span></td>
                    <td>${location}</td>
                    <td>${type}</td>
                    <td>${site}</td>
                    <td><span class="health-score ${healthClass}">${healthScore}/100</span></td>
                    <td>2 hours ago</td>
                `;
                tbody.appendChild(row);
            }
        }

        function closeAnalyticsModal() {
            document.getElementById('statusFilterModal').style.display = 'none';
        }

        // Analytics Charts - Declare BEFORE they're used
        let analyticsCharts = {};
        
        function initAnalyticsCharts() {
            // Clean up old charts
            Object.values(analyticsCharts).forEach(chart => {
                if (chart) chart.destroy();
            });
            
            // Generate 30 days of labels
            const labels = [];
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push((date.getMonth() + 1) + '/' + date.getDate());
            }
            
            // Generate realistic alarm data for 30 days
            const alarmData = [];
            for (let i = 0; i < 30; i++) {
                // Simulate increasing trend with some randomness
                const baseValue = 2 + (i * 0.15);
                const randomOffset = (Math.random() - 0.5) * 2;
                alarmData.push(Math.max(0, Math.round(baseValue + randomOffset)));
            }
            
            const ctx1 = document.getElementById('eventTimelineChart');
            if (ctx1) {
                analyticsCharts.timeline = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Alarms (Last 30 Days)',
                            data: alarmData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return 'Date: ' + context[0].label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });
            }
            
            // Doughnut chart with more realistic totals
            const totalAlarms = alarmData.reduce((a, b) => a + b, 0);
            const totalFaults = Math.round(totalAlarms * 0.4);
            const totalPreAlarms = Math.round(totalAlarms * 0.6);
            
            const ctx2 = document.getElementById('eventDistChart');
            if (ctx2) {
                analyticsCharts.dist = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Alarms', 'Faults', 'Pre-Alarms'],
                        datasets: [{
                            data: [totalAlarms, totalFaults, totalPreAlarms],
                            backgroundColor: ['#ef4444', '#f59e0b', '#eab308']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return label + ': ' + value + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function openDeviceAnalytics(address, location, type, status, healthScore) {
            const modal = document.getElementById('deviceAnalyticsModal');
            if (!modal) return;
            
            // Hide AI overview when opening new device
            const aiContent = document.getElementById('aiOverviewContent');
            const aiBtn = document.getElementById('aiOverviewBtnText');
            if (aiContent) aiContent.style.display = 'none';
            if (aiBtn) aiBtn.textContent = 'Generate AI Overview';
            
            document.getElementById('detailAddress').textContent = address;
            document.getElementById('detailLocation').textContent = location;
            document.getElementById('detailType').textContent = type;
            document.getElementById('detailStatus').textContent = status.toUpperCase();
            document.getElementById('detailStatus').className = `status-badge-large ${status}`;
            document.getElementById('aiHealthScore').textContent = healthScore;
            
            // Set metrics
            document.getElementById('totalAlarms').textContent = Math.floor(Math.random() * 15) + 5;
            document.getElementById('totalPreAlarms').textContent = Math.floor(Math.random() * 12) + 3;
            document.getElementById('totalFaults').textContent = Math.floor(Math.random() * 8) + 1;
            document.getElementById('totalIsolates').textContent = Math.floor(Math.random() * 10) + 2;
            document.getElementById('failureRisk').textContent = (100 - healthScore) + '%';
            
            modal.style.display = 'flex';
            initAnalyticsCharts();
        }

        function closeDeviceAnalytics() {
            // Destroy charts before closing
            if (typeof analyticsCharts !== 'undefined') {
                Object.values(analyticsCharts).forEach(chart => {
                    if (chart && typeof chart.destroy === 'function') {
                        chart.destroy();
                    }
                });
            }
            document.getElementById('deviceAnalyticsModal').style.display = 'none';
        }

        function toggleAIOverview() {
            const content = document.getElementById('aiOverviewContent');
            const btn = document.getElementById('aiOverviewBtnText');
            const overlay = document.getElementById('aiLoadingOverlay');
            
            if (content.style.display === 'block') {
                content.style.display = 'none';
                btn.textContent = 'Generate AI Overview';
            } else {
                // Show full-screen flame overlay
                if (overlay) {
                    overlay.style.display = 'flex';
                }
                
                btn.textContent = 'AI Analyzing...';
                
                // Simulate AI processing time
                setTimeout(() => {
                    // Hide overlay
                    if (overlay) {
                        overlay.style.display = 'none';
                    }
                    
                    // Show AI insights
                    content.style.display = 'block';
                    btn.textContent = 'Hide AI Overview';
                }, 2500); // 2.5 seconds for dramatic effect
            }
        }

    </script>

    <!-- Status Filter Modal -->
    <div id="statusFilterModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 95%; max-height: 95vh; overflow-y: auto; width: 1400px;">
            <div style="padding: 24px; border-bottom: 1px solid #e5e7eb; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px 16px 0 0; display: flex; align-items: center; justify-content: space-between;">
                <div style="font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
                    <span id="statusIcon">ðŸš¨</span>
                    <span id="statusModalTitle">Critical Devices</span>
                </div>
                <button onclick="closeAnalyticsModal()" style="width: 36px; height: 36px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <div style="padding: 24px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span id="statusBadge" class="status-badge-large critical">CRITICAL</span>
                        <span id="deviceCount" style="font-size: 28px; font-weight: 700;">23 devices</span>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="device-table">
                        <thead>
                            <tr>
                                <th>Address</th>
                                <th>Location</th>
                                <th>Device Type</th>
                                <th>Site</th>
                                <th>Health Score</th>
                                <th>Last Event</th>
                            </tr>
                        </thead>
                        <tbody id="analyticsDeviceTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Analytics Modal -->
    <div id="deviceAnalyticsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 95%; max-height: 95vh; overflow-y: auto; width: 1200px;">
            <div style="padding: 24px; border-bottom: 1px solid #e5e7eb; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px 16px 0 0; display: flex; align-items: center; justify-content: space-between;">
                <div style="font-size: 20px; font-weight: 700;">ðŸ“Š Device Analytics</div>
                <button onclick="closeDeviceAnalytics()" style="width: 36px; height: 36px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 50%; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <div style="padding: 24px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div style="background: #f9fafb; padding: 16px; border-radius: 12px;">
                        <div style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 8px;">Device Address</div>
                        <div id="detailAddress" style="font-size: 16px; font-weight: 700;">Zone 1, Loop 3, Device 4</div>
                    </div>
                    <div style="background: #f9fafb; padding: 16px; border-radius: 12px;">
                        <div style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 8px;">Location</div>
                        <div id="detailLocation" style="font-size: 16px; font-weight: 700;">Level 4, Office</div>
                    </div>
                    <div style="background: #f9fafb; padding: 16px; border-radius: 12px;">
                        <div style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 8px;">Device Type</div>
                        <div id="detailType" style="font-size: 16px; font-weight: 700;">Smoke Detector</div>
                    </div>
                    <div style="background: #f9fafb; padding: 16px; border-radius: 12px;">
                        <div style="font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 8px;">Current Status</div>
                        <span id="detailStatus" class="status-badge-large critical">ALARM</span>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div id="aiHealthScore" style="font-size: 72px; font-weight: 900; line-height: 1;">87</div>
                        <div style="font-size: 16px; opacity: 0.9;">AI Health Score</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                            <div id="totalAlarms" style="font-size: 24px; font-weight: 700;">12</div>
                            <div style="font-size: 12px; opacity: 0.8;">Alarms</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                            <div id="totalPreAlarms" style="font-size: 24px; font-weight: 700;">8</div>
                            <div style="font-size: 12px; opacity: 0.8;">Pre-Alarms</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                            <div id="totalFaults" style="font-size: 24px; font-weight: 700;">3</div>
                            <div style="font-size: 12px; opacity: 0.8;">Faults</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                            <div id="totalIsolates" style="font-size: 24px; font-weight: 700;">5</div>
                            <div style="font-size: 12px; opacity: 0.8;">Isolates</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                            <div id="failureRisk" style="font-size: 24px; font-weight: 700;">12%</div>
                            <div style="font-size: 12px; opacity: 0.8;">Failure Risk</div>
                        </div>
                    </div>
                    <button onclick="toggleAIOverview()" style="width: 100%; padding: 16px; background: white; color: #667eea; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>ðŸ¤–</span>
                        <span id="aiOverviewBtnText">Generate AI Overview</span>
                    </button>
                    <div id="aiOverviewContent" style="display: none; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-top: 16px;">
                        <div style="background: rgba(255,255,255,0.9); color: #1f2937; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <div style="font-weight: 700; margin-bottom: 8px;">ðŸ“ˆ Event Pattern Analysis</div>
                            <div>This device shows increasing alarm frequency over the past 30 days, suggesting potential sensitivity or environmental issues requiring investigation.</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.9); color: #1f2937; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <div style="font-weight: 700; margin-bottom: 8px;">ðŸ”® Predictive Maintenance Alert</div>
                            <div>Based on patterns, this device has elevated failure risk within 90 days. Recommend scheduling preventive maintenance.</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.9); color: #1f2937; padding: 12px; border-radius: 8px;">
                            <div style="font-weight: 700; margin-bottom: 8px;">ðŸ’¡ Recommended Actions</div>
                            <div>1. Schedule inspection within 7 days<br>2. Check environmental factors<br>3. Review sensitivity settings</div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">Event Timeline</div>
                        <div style="position: relative; height: 250px;">
                            <canvas id="eventTimelineChart"></canvas>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">Event Distribution</div>
                        <div style="position: relative; height: 250px;">
                            <canvas id="eventDistChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Flame Animation */
        .flame {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 24px;
            background: linear-gradient(180deg, #ff6b00 0%, #ff0000 50%, #ff9500 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 0.6s infinite alternate;
            filter: blur(1px);
        }

        .flame-inner {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 16px;
            background: linear-gradient(180deg, #ffeb3b 0%, #ff6b00 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker-inner 0.4s infinite alternate;
            filter: blur(0.5px);
        }

        .flame-spark {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #ffeb3b;
            border-radius: 50%;
            animation: spark 1.2s infinite;
            filter: blur(0.5px);
        }

        @keyframes flicker {
            0%, 100% {
                transform: translateX(-50%) scaleY(1) scaleX(1);
                opacity: 1;
            }
            25% {
                transform: translateX(-50%) scaleY(1.05) scaleX(0.95);
                opacity: 0.9;
            }
            50% {
                transform: translateX(-50%) scaleY(0.95) scaleX(1.05);
                opacity: 1;
            }
            75% {
                transform: translateX(-50%) scaleY(1.02) scaleX(0.98);
                opacity: 0.95;
            }
        }

        @keyframes flicker-inner {
            0%, 100% {
                transform: translateX(-50%) scaleY(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scaleY(0.9);
                opacity: 0.85;
            }
        }

        @keyframes spark {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(0);
            }
            30% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-12px);
            }
        }

        /* Large Flame for Full-Screen Loading */
        .flame-large {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 64px;
            height: 96px;
            background: linear-gradient(180deg, #ff6b00 0%, #ff0000 50%, #ff9500 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 0.6s infinite alternate;
            filter: blur(3px);
            box-shadow: 0 0 40px rgba(255, 107, 0, 0.8);
        }

        .flame-inner-large {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 64px;
            background: linear-gradient(180deg, #ffeb3b 0%, #ff6b00 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker-inner 0.4s infinite alternate;
            filter: blur(2px);
            box-shadow: 0 0 30px rgba(255, 235, 59, 0.6);
        }

        .flame-spark-large {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: #ffeb3b;
            border-radius: 50%;
            animation: spark-large 1.2s infinite;
            filter: blur(2px);
            box-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
        }

        @keyframes spark-large {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(0) scale(1);
            }
            30% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-48px) scale(0.5);
            }
        }

        @keyframes pulse-text {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .status-badge-large {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }
        .status-badge-large.critical {
            background: #fee2e2;
            color: #dc2626;
        }
        .status-badge-large.warning {
            background: #fef3c7;
            color: #d97706;
        }
        .status-badge-large.monitor {
            background: #dbeafe;
            color: #2563eb;
        }
        .status-badge-large.normal {
            background: #d1fae5;
            color: #059669;
        }
        .health-score {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 13px;
        }
        .health-score.excellent {
            background: #d1fae5;
            color: #059669;
        }
        .health-score.good {
            background: #dbeafe;
            color: #2563eb;
        }
        .health-score.fair {
            background: #fef3c7;
            color: #d97706;
        }
        .health-score.poor {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
    <!-- AI Loading Overlay - Full Screen Flame -->
    <div id="aiLoadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0, 0, 0, 0.85); z-index: 20000; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(5px);">
        <div id="aiLoadingFlame" style="position: relative; width: 80px; height: 120px; margin-bottom: 30px;">
            <div class="flame-large"></div>
            <div class="flame-inner-large"></div>
            <div class="flame-spark-large" style="left: 45%;"></div>
            <div class="flame-spark-large" style="left: 55%; animation-delay: 0.4s;"></div>
            <div class="flame-spark-large" style="left: 50%; animation-delay: 0.8s;"></div>
        </div>
        <div style="color: white; font-size: 24px; font-weight: 700; text-align: center; animation: pulse-text 1.5s infinite;">
            ðŸ¤– AI Analyzing Device Data...
        </div>
        <div style="color: rgba(255,255,255,0.6); font-size: 14px; margin-top: 12px; text-align: center;">
            Processing patterns and generating insights
        </div>
    </div>

</body>
</html>
